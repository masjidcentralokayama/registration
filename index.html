<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Registrasi Buka Puasa Bersama 1447 H</title>

<!-- Apps Script Deployment URL - SAMA DENGAN ADMIN -->
<meta name="api-url" content="https://script.google.com/macros/s/AKfycbzZmeIcRGGskXXDLhhAVjL7cztMDEOgYYqwwe5knHcrClJ8Cyb3-pDMhaxqVRBmPkLi/exec">

<!-- Open Graph Tags -->
<meta property="og:title" content="Registrasi Buka Puasa Bersama 1447 H">
<meta property="og:description" content="Daftar untuk menghadiri buka puasa bersama di Masjid Central Okayama">
<meta property="og:image" content="https://example.com/iftar-og.jpg">
<meta property="og:url" content="">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&family=Open+Sans:wght@400;500;600&display=swap" rel="stylesheet">

<style>
/* RESET & BASE STYLES */
:root {
  --accent-green: #10a37f;
  --accent-gold: #d4af37;
  --accent-teal: #0f766e;
  --accent-dark: #1e293b;
  --accent-light: #f8fafc;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Poppins', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  background: linear-gradient(135deg, #f7f7f8 0%, #f0f9ff 100%);
  color: var(--accent-dark);
  line-height: 1.6;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

main {
  padding: 2rem 1rem;
  position: relative;
  overflow: hidden;
}

.container {
  max-width: 520px;
  margin: 0 auto;
  position: relative;
  z-index: 1;
}

/* DECORATIVE ELEMENTS */
.ornament-top {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 120px;
  background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-teal) 100%);
  clip-path: polygon(0 0, 100% 0, 100% 70%, 0 100%);
  z-index: 0;
  opacity: 0.9;
}

.ornament-bottom {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 80px;
  background: linear-gradient(135deg, var(--accent-teal) 0%, var(--accent-green) 100%);
  clip-path: polygon(0 30%, 100% 0, 100% 100%, 0 100%);
  z-index: 0;
  opacity: 0.9;
}

.islamic-pattern {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-image: 
    radial-gradient(circle at 10% 10%, rgba(16, 163, 127, 0.05) 1px, transparent 1px),
    radial-gradient(circle at 90% 90%, rgba(212, 175, 55, 0.05) 1px, transparent 1px);
  background-size: 30px 30px;
  z-index: 0;
}

/* HEADER STYLES */
.header {
  text-align: center;
  margin-bottom: 2.5rem;
  padding: 0 0.5rem;
  position: relative;
}

.header-icon {
  width: 80px;
  height: 80px;
  background: white;
  border-radius: 50%;
  margin: 0 auto 1.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 20px rgba(16, 163, 127, 0.15);
  border: 2px solid var(--accent-gold);
  position: relative;
  overflow: hidden;
}

.header-icon i {
  font-size: 2.5rem;
  color: var(--accent-green);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.header h1 {
  margin: 0 0 1rem 0;
  font-size: 1.9rem;
  color: var(--accent-dark);
  font-weight: 700;
  letter-spacing: -0.01em;
  line-height: 1.3;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  position: relative;
  display: inline-block;
}

.header h1::after {
  content: '';
  position: absolute;
  bottom: -10px;
  left: 50%;
  transform: translateX(-50%);
  width: 100px;
  height: 3px;
  background: linear-gradient(90deg, transparent, var(--accent-gold), transparent);
  border-radius: 2px;
}

.header .center-name {
  color: var(--accent-teal);
  font-weight: 600;
  font-size: 1.1rem;
  margin-bottom: 1rem;
  font-family: 'Poppins', sans-serif;
}

.header .subtitle {
  color: #64748b;
  font-size: 0.95rem;
  font-weight: 400;
  line-height: 1.6;
  margin-bottom: 1rem;
  max-width: 480px;
  margin-left: auto;
  margin-right: auto;
}

.event-purpose {
  background: linear-gradient(135deg, rgba(16, 163, 127, 0.08) 0%, rgba(15, 118, 110, 0.08) 100%);
  border-radius: 12px;
  padding: 1rem 1.25rem;
  margin: 1.5rem auto 0;
  max-width: 480px;
  border-left: 4px solid var(--accent-gold);
  font-size: 0.9rem;
  color: var(--accent-teal);
  line-height: 1.6;
  font-style: italic;
  text-align: center;
  box-shadow: 0 2px 8px rgba(16, 163, 127, 0.1);
}

.islamic-divider {
  text-align: center;
  margin: 1.5rem 0;
  position: relative;
}

.islamic-divider::before,
.islamic-divider::after {
  content: '';
  position: absolute;
  top: 50%;
  width: 30%;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--accent-gold), transparent);
}

.islamic-divider::before {
  left: 0;
}

.islamic-divider::after {
  right: 0;
}

.islamic-divider span {
  color: var(--accent-gold);
  font-size: 1.2rem;
  letter-spacing: 8px;
  display: inline-block;
  padding: 0 10px;
  background: var(--accent-light);
}

/* CARD STYLES */
.card {
  background: #ffffff;
  padding: 2.5rem;
  border-radius: 16px;
  border: 1px solid #e2e8f0;
  box-shadow: 0 8px 32px rgba(16, 163, 127, 0.08);
  margin-bottom: 2.5rem;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 4px;
  height: 100%;
  background: linear-gradient(180deg, var(--accent-green), var(--accent-gold));
}

.card:hover {
  box-shadow: 0 12px 40px rgba(16, 163, 127, 0.12);
  transform: translateY(-2px);
}

/* SECTION TITLES */
.section-title {
  font-size: 0.95rem;
  color: var(--accent-teal);
  border-left: 3px solid var(--accent-gold);
  padding-left: 1rem;
  margin: 2.5rem 0 1.5rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-family: 'Poppins', sans-serif;
  position: relative;
  padding-top: 0.25rem;
  padding-bottom: 0.25rem;
}

.section-title:first-child {
  margin-top: 0;
}

.section-title::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: linear-gradient(180deg, var(--accent-green), var(--accent-gold));
  border-radius: 2px;
}

/* FORM FIELD STYLES */
.field {
  margin-bottom: 1.75rem;
  position: relative;
}

label {
  display: block;
  margin-bottom: 0.75rem;
  font-weight: 600;
  font-size: 0.9rem;
  color: var(--accent-dark);
  letter-spacing: -0.01em;
  font-family: 'Poppins', sans-serif;
}

.input-wrapper {
  position: relative;
  transition: all 0.3s ease;
}

.input-wrapper:hover {
  transform: translateY(-1px);
}

.input-wrapper i {
  position: absolute;
  left: 1rem;
  top: 50%;
  transform: translateY(-50%);
  color: #94a3b8;
  font-size: 1rem;
  transition: color 0.3s ease;
}

input:focus + i,
select:focus + i {
  color: var(--accent-green);
}

input, select {
  width: 100%;
  padding: 1rem 1rem 1rem 3rem;
  border-radius: 10px;
  border: 1.5px solid #e2e8f0;
  font-size: 0.95rem;
  font-family: 'Inter', sans-serif;
  background: #ffffff;
  transition: all 0.3s ease;
  color: var(--accent-dark);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
}

input:focus, select:focus {
  outline: none;
  border-color: var(--accent-green);
  box-shadow: 0 0 0 3px rgba(16, 163, 127, 0.15);
  background: #ffffff;
}

/* SELECT STYLES */
select {
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2394a3b8'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 1rem center;
  background-size: 1.25rem;
  padding-right: 3rem;
  cursor: pointer;
}

/* RADIO & TOGGLE BUTTON STYLES */
.radio-group, .toggle-group {
  display: flex;
  gap: 0.75rem;
}

.radio-group input, .toggle-group input {
  display: none;
}

.radio-group label, .toggle-group label {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 1rem 1.25rem;
  border-radius: 10px;
  border: 1.5px solid #e2e8f0;
  background: #f8fafc;
  font-size: 0.9rem;
  font-weight: 500;
  color: #475569;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-bottom: 0;
}

.radio-group label i, .toggle-group label i {
  position: static;
  transform: none;
  font-size: 1rem;
}

.radio-group input:checked + label,
.toggle-group input:checked + label {
  background: rgba(16, 163, 127, 0.1);
  border-color: var(--accent-green);
  color: var(--accent-teal);
  font-weight: 600;
  box-shadow: 0 4px 8px rgba(16, 163, 127, 0.1);
}

/* OTP CONTAINER */
.otp-container {
  display: flex;
  gap: 0.75rem;
  align-items: center;
}

.otp-container .input-wrapper {
  flex: 1;
}

.btn-otp {
  padding: 1rem 1.5rem;
  background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-teal) 100%);
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.3s ease;
  font-family: 'Poppins', sans-serif;
  min-width: 120px;
  box-shadow: 0 4px 12px rgba(16, 163, 127, 0.2);
}

.btn-otp:hover {
  background: linear-gradient(135deg, var(--accent-teal) 0%, var(--accent-green) 100%);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(16, 163, 127, 0.3);
}

.btn-otp:disabled {
  background: #cbd5e1;
  transform: none;
  box-shadow: none;
  cursor: not-allowed;
}

/* HINT TEXT */
.hint {
  font-size: 0.8rem;
  color: #64748b;
  margin-top: 0.5rem;
  line-height: 1.5;
  padding-left: 0.25rem;
}

/* ROW LAYOUT */
.row {
  display: flex;
  gap: 1rem;
}

.row .field {
  flex: 1;
}

/* OTP FIELD */
.otp-field {
  display: none;
  background: linear-gradient(135deg, rgba(16, 163, 127, 0.05) 0%, rgba(15, 118, 110, 0.05) 100%);
  padding: 1.25rem;
  border-radius: 12px;
  border: 1.5px dashed var(--accent-green);
  margin-bottom: 1.75rem;
  position: relative;
  overflow: hidden;
}

.otp-field::before {
  content: 'âœ“';
  position: absolute;
  top: 10px;
  right: 10px;
  color: var(--accent-green);
  font-size: 1.2rem;
  font-weight: bold;
  opacity: 0.3;
}

.otp-field.active {
  display: block;
  animation: slideDown 0.3s ease;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* OTHER NATIONALITY FIELD */
.other-nationality-wrapper {
  display: none;
  margin-top: 1rem;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.other-nationality-wrapper.active {
  display: block;
}

/* CHILDREN FIELD */
.children-field-wrapper {
  display: none;
  margin-top: 1rem;
  animation: fadeIn 0.3s ease;
}

.children-field-wrapper.active {
  display: block;
}

/* TOTAL SUMMARY */
.total-summary {
  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  border: 1.5px solid #e2e8f0;
  border-radius: 12px;
  padding: 1.75rem;
  margin-top: 2rem;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.total-summary::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--accent-green), var(--accent-gold), var(--accent-teal));
}

.total-number {
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--accent-teal);
  margin: 0.5rem 0;
  font-family: 'Poppins', sans-serif;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.total-label {
  font-size: 0.9rem;
  color: var(--accent-dark);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  font-weight: 600;
  margin-bottom: 0.75rem;
}

.total-label i {
  color: var(--accent-green);
  font-size: 1.2rem;
}

/* CONSENT CHECKBOX */
.consent {
  display: flex;
  align-items: flex-start;
  gap: 1rem;
  padding: 1.5rem;
  background: linear-gradient(135deg, rgba(16, 163, 127, 0.05) 0%, rgba(15, 118, 110, 0.05) 100%);
  border: 1.5px solid #e2e8f0;
  border-radius: 12px;
  margin: 2rem 0;
  transition: all 0.3s ease;
}

.consent:hover {
  border-color: var(--accent-green);
  background: linear-gradient(135deg, rgba(16, 163, 127, 0.08) 0%, rgba(15, 118, 110, 0.08) 100%);
}

.consent input {
  width: 1.5rem;
  height: 1.5rem;
  margin-top: 0.125rem;
  flex-shrink: 0;
  border-radius: 6px;
  accent-color: var(--accent-green);
  cursor: pointer;
}

.consent label {
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
  margin-bottom: 0;
  cursor: pointer;
  font-weight: 500;
  line-height: 1.6;
}

.consent-label-text {
  font-size: 0.9rem;
  color: var(--accent-dark);
  line-height: 1.6;
  font-weight: 500;
}

.consent-label-text strong {
  color: var(--accent-teal);
  font-weight: 600;
}

/* BUTTON */
.submit-btn {
  width: 100%;
  padding: 1.25rem;
  background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-teal) 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  font-family: 'Poppins', sans-serif;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  box-shadow: 0 6px 20px rgba(16, 163, 127, 0.2);
  position: relative;
  overflow: hidden;
}

.submit-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s ease;
}

.submit-btn:hover {
  background: linear-gradient(135deg, var(--accent-teal) 0%, var(--accent-green) 100%);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(16, 163, 127, 0.3);
}

.submit-btn:hover::before {
  left: 100%;
}

.submit-btn:disabled {
  background: #cbd5e1;
  transform: none;
  box-shadow: none;
  cursor: not-allowed;
}

.submit-btn:disabled::before {
  display: none;
}

/* ALERT */
.alert {
  display: none;
  background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
  color: #dc2626;
  padding: 1.25rem;
  border-radius: 12px;
  border: 1.5px solid #fecaca;
  margin-bottom: 1.75rem;
  text-align: center;
  font-size: 0.9rem;
  font-weight: 500;
  animation: slideDown 0.3s ease;
}

.alert.active {
  display: block;
}

/* SUCCESS MESSAGE */
.success-message {
  display: none;
  background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
  color: #166534;
  padding: 1.25rem;
  border-radius: 12px;
  border: 1.5px solid #bbf7d0;
  margin-bottom: 1.75rem;
  text-align: center;
  font-size: 0.9rem;
  font-weight: 500;
  animation: slideDown 0.3s ease;
}

.success-message.active {
  display: block;
}

/* INFO MESSAGE */
.info-message {
  display: none;
  background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
  color: #0369a1;
  padding: 1.25rem;
  border-radius: 12px;
  border: 1.5px solid #bae6fd;
  margin-bottom: 1.75rem;
  text-align: center;
  font-size: 0.9rem;
  font-weight: 500;
  animation: slideDown 0.3s ease;
}

.info-message.active {
  display: block;
}

/* FOOTER */
footer {
  text-align: center;
  color: #64748b;
  font-size: 0.85rem;
  padding: 1.5rem 0;
  border-top: 1px solid #e2e8f0;
  margin-top: 3rem;
  position: relative;
}

.prayer-message {
  background: linear-gradient(135deg, rgba(212, 175, 55, 0.08) 0%, rgba(16, 163, 127, 0.08) 100%);
  border-radius: 12px;
  padding: 1rem 1.5rem;
  margin: 1rem auto 1.5rem;
  max-width: 500px;
  color: var(--accent-teal);
  font-style: italic;
  line-height: 1.6;
  font-size: 0.9rem;
  border: 1px solid rgba(212, 175, 55, 0.2);
}

footer .center-name {
  font-weight: 600;
  color: var(--accent-teal);
  margin-bottom: 0.5rem;
  font-size: 0.9rem;
}

footer .contact {
  margin-top: 0.75rem;
  font-size: 0.8rem;
  color: #94a3b8;
}

footer .contact a {
  color: var(--accent-green);
  text-decoration: none;
  transition: color 0.3s ease;
}

footer .contact a:hover {
  color: var(--accent-teal);
  text-decoration: underline;
}

/* RESPONSIVE */
@media (max-width: 640px) {
  main {
    padding: 1.5rem 1rem;
  }
  
  .card {
    padding: 1.75rem;
  }
  
  .row {
    flex-direction: column;
    gap: 1rem;
  }
  
  .otp-container {
    flex-direction: column;
    gap: 1rem;
    align-items: stretch;
  }
  
  .btn-otp {
    width: 100%;
    padding: 0.9rem;
    font-size: 0.85rem;
    min-width: unset;
  }
  
  .otp-container .input-wrapper {
    width: 100%;
  }
  
  input, select {
    padding: 0.9rem 1rem 0.9rem 2.75rem;
    font-size: 0.9rem;
  }
  
  .input-wrapper i {
    left: 0.875rem;
    font-size: 0.9rem;
  }
  
  .otp-field {
    padding: 1rem;
  }
  
  .total-summary {
    padding: 1.5rem;
  }
  
  .total-number {
    font-size: 2.2rem;
  }
  
  .header h1 {
    font-size: 1.7rem;
  }
  
  .header-icon {
    width: 70px;
    height: 70px;
  }
  
  .header-icon i {
    font-size: 2rem;
  }
  
  .section-title {
    margin: 2rem 0 1.25rem;
  }
}

/* LOADING SPINNER */
.loading-spinner {
  display: inline-block;
  width: 1.2rem;
  height: 1.2rem;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: #fff;
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* LANGUAGE SELECTOR */
.language-selector {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 100;
  background: white;
  padding: 8px 12px;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.language-selector select {
  padding: 6px 10px;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  font-size: 0.9rem;
  font-family: 'Inter', sans-serif;
  color: var(--accent-dark);
}

.language-selector select:focus {
  outline: none;
  border-color: var(--accent-green);
}

/* PROGRESS INDICATOR */
.progress-indicator {
  display: none;
  text-align: center;
  margin-top: 1rem;
}

.progress-indicator.active {
  display: block;
}
</style>
</head>

<body>
<!-- Decorative Background Elements -->
<div class="ornament-top"></div>
<div class="ornament-bottom"></div>
<div class="islamic-pattern"></div>

<!-- Language Selector -->
<div class="language-selector">
  <select id="languageSelector">
    <option value="id">ğŸ‡®ğŸ‡© Indonesia</option>
    <option value="en">ğŸ‡¬ğŸ‡§ English</option>
    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
  </select>
</div>

<main>
  <div class="container">
    <!-- Alert Messages -->
    <div class="alert" id="duplicateAlert">
      <i class="fas fa-exclamation-triangle"></i>
      <span id="duplicateAlertText">Data ini sudah terdaftar</span>
    </div>

    <div class="info-message" id="infoMessage">
      <i class="fas fa-info-circle"></i>
      <span id="infoMessageText">Setelah submit, Anda akan diarahkan ke halaman konfirmasi</span>
    </div>

    <div class="success-message" id="successMessage">
      <i class="fas fa-check-circle"></i>
      <span id="successMessageText"></span>
    </div>

    <!-- Header -->
    <div class="header">
      <div class="header-icon">
        <i class="fas fa-mosque"></i>
      </div>
      
      <h1 id="mainTitle">Registrasi Buka Puasa Bersama 1447 H</h1>
      
      <div class="center-name" id="centerName">Masjid Central Okayama</div>
      
      <div class="subtitle" id="subtitleText">
        Silakan lengkapi formulir registrasi di bawah ini dengan data yang valid
      </div>
      
      <div class="event-purpose" id="eventPurpose">
        Formulir ini digunakan untuk pendataan jamaah agar pelaksanaan buka puasa bersama berjalan tertib, nyaman, dan penuh keberkahan
      </div>
    </div>

    <!-- Islamic Divider -->
    <div class="islamic-divider">
      <span>âœ¦ âœ¦ âœ¦</span>
    </div>

    <!-- Registration Form -->
    <div class="card">
      <form id="registrationForm" autocomplete="on">
        
        <!-- Section: Data Jamaah -->
        <h3 class="section-title" id="sectionDataJamaah">
          <i class="fas fa-user"></i> Data Jamaah
        </h3>

        <!-- Full Name -->
        <div class="field">
          <label for="nama_lengkap" id="labelNamaLengkap">Nama Lengkap</label>
          <div class="input-wrapper">
            <i class="fas fa-user"></i>
            <input type="text" id="nama_lengkap" name="nama_lengkap" required 
                   placeholder="Nama sesuai identitas" minlength="3" maxlength="100">
          </div>
          <div class="hint">Wajib diisi sesuai KTP/Identitas</div>
        </div>

        <!-- Email -->
        <div class="field">
          <label for="email" id="labelEmail">Alamat Email</label>
          <div class="otp-container">
            <div class="input-wrapper">
              <i class="fas fa-envelope"></i>
              <input type="email" id="email" name="email" required 
                     placeholder="contoh@email.com" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$">
            </div>
            <button type="button" class="btn-otp" id="sendOtpBtn" disabled>
              <span id="sendOtpText">Kirim OTP</span>
            </button>
          </div>
          <div class="hint" id="hintEmail">Kode OTP akan dikirim ke email ini</div>
        </div>

        <!-- OTP Field -->
        <div class="otp-field" id="otpField">
          <label for="otp_input" id="labelOtp">Kode OTP</label>
          <div class="input-wrapper">
            <i class="fas fa-key"></i>
            <input type="tel" id="otp_input" inputmode="numeric" pattern="[0-9]{6}" 
                   maxlength="6" placeholder="Masukkan 6 digit kode">
          </div>
          <div class="hint" id="otpHint">Periksa inbox atau spam folder email Anda</div>
        </div>

        <!-- Phone Number -->
        <div class="field">
          <label for="no_hp" id="labelNoHp">Nomor Telepon</label>
          <div class="input-wrapper">
            <i class="fas fa-phone"></i>
            <input type="tel" id="no_hp" name="no_hp" required pattern="[0-9]{10,15}" 
                   placeholder="081234567890" inputmode="numeric">
          </div>
          <div class="hint" id="hintNoHp">Gunakan nomor aktif yang dapat dihubungi</div>
        </div>

        <!-- Residence -->
        <div class="field">
          <label for="domisili" id="labelDomisili">Domisili</label>
          <div class="input-wrapper">
            <i class="fas fa-map-marker-alt"></i>
            <input type="text" id="domisili" name="domisili" list="neighborhoods" required 
                   placeholder="Cari nama kelurahan/kecamatan">
            <datalist id="neighborhoods">
              <option value="Okayama-shi, Kita-ku, Kaminakano">
              <option value="Okayama-shi, Kita-ku, Ima">
              <option value="Okayama-shi, Kita-ku, Omoto">
              <option value="Okayama-shi, Kita-ku, Tsushima">
              <option value="Okayama-shi, Kita-ku, Hokan-cho">
              <option value="Okayama-shi, Naka-ku, Nishigawara">
              <option value="Okayama-shi, Minami-ku, Toyonari">
              <option value="Kurashiki-shi, Achi">
              <option value="Kurashiki-shi, Nakasho">
              <option value="Kurashiki-shi, Chaya-machi">
              <option value="Kurashiki-shi, Mizushima">
              <option value="Kurashiki-shi, Kojima">
              <option value="Kurashiki-shi, Tamashima">
              <option value="Tamano-shi, Chikko">
              <option value="Tamano-shi, Uno">
              <option value="Tamano-shi, Hibibi">
              <option value="Tamano-shi, Shibukawa">
              <option value="Soja-shi, Chuo">
              <option value="Soja-shi, Kiyone">
              <option value="Soja-shi, Yamate">
              <option value="Akaiwa-shi, Sanyo">
              <option value="Setouchi-shi, Oku-cho">
            </datalist>
          </div>
        </div>

        <!-- Nationality -->
        <div class="field">
          <label for="kebangsaan" id="labelKebangsaan">Kebangsaan</label>
          <div class="input-wrapper">
            <i class="fas fa-globe"></i>
            <select id="kebangsaan" name="kebangsaan" required>
              <option value="">Pilih kebangsaan</option>
              <option value="Indonesia">Indonesia</option>
              <option value="Jepang">Jepang</option>
              <option value="Lainnya">Lainnya</option>
            </select>
          </div>

          <div class="other-nationality-wrapper" id="otherNationalityWrapper">
            <div class="input-wrapper">
              <i class="fas fa-edit"></i>
              <input type="text" id="kebangsaan_lainnya" name="kebangsaan_lainnya"
                     placeholder="Masukkan kebangsaan Anda">
            </div>
          </div>
        </div>

        <!-- Age & Gender -->
        <div class="row">
          <div class="field">
            <label for="usia" id="labelUsia">Usia</label>
            <div class="input-wrapper">
              <i class="fas fa-birthday-cake"></i>
              <input type="number" id="usia" name="usia" min="1" max="120" required 
                     placeholder="Usia saat ini">
            </div>
          </div>

          <div class="field">
            <label id="labelJenisKelamin">Jenis Kelamin</label>
            <div class="radio-group">
              <input type="radio" id="jk_l" name="jk" value="Laki-laki" required checked>
              <label for="jk_l">
                <i class="fas fa-mars"></i>
                <span id="labelLakiLaki">Laki-laki</span>
              </label>
              <input type="radio" id="jk_p" name="jk" value="Perempuan">
              <label for="jk_p">
                <i class="fas fa-venus"></i>
                <span id="labelPerempuan">Perempuan</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Section: Informasi Kehadiran -->
        <h3 class="section-title" id="sectionKehadiran">
          <i class="fas fa-users"></i> Informasi Kehadiran
        </h3>

        <!-- Additional Adults -->
        <div class="field">
          <label for="dewasa_tambahan" id="labelDewasaTambahan">Dewasa Tambahan</label>
          <div class="input-wrapper">
            <i class="fas fa-user-plus"></i>
            <input type="number" id="dewasa_tambahan" name="dewasa_tambahan" min="0" max="5" value="0"
                   placeholder="Jumlah dewasa selain Anda">
          </div>
          <div class="hint" id="hintDewasa">Usia 13 tahun ke atas</div>
        </div>

        <!-- Children -->
        <div class="field">
          <label id="labelDatangDenganAnak">Datang dengan Anak?</label>
          <div class="toggle-group">
            <input type="radio" id="anak_tidak" name="dengan_anak" value="Tidak" checked>
            <label for="anak_tidak">
              <i class="fas fa-times"></i>
              <span id="labelTidak">Tidak</span>
            </label>
            <input type="radio" id="anak_ya" name="dengan_anak" value="Ya">
            <label for="anak_ya">
              <i class="fas fa-child"></i>
              <span id="labelYa">Ya</span>
            </label>
          </div>
          <div class="hint" id="hintAnak">Anak usia 0-12 tahun</div>
        </div>

        <!-- Number of Children -->
        <div class="children-field-wrapper" id="childrenFieldWrapper">
          <div class="field">
            <label for="jumlah_anak" id="labelJumlahAnak">Jumlah Anak</label>
            <div class="input-wrapper">
              <i class="fas fa-baby"></i>
              <input type="number" id="jumlah_anak" name="jumlah_anak" min="1" max="5" value="1">
            </div>
            <div class="hint" id="hintUsiaAnak">Usia maksimal 12 tahun</div>
          </div>
        </div>

        <!-- Total Summary -->
        <div class="total-summary">
          <div class="total-label">
            <i class="fas fa-users"></i>
            <span id="totalLabel">Total yang akan hadir</span>
          </div>
          <div class="total-number" id="totalAttendees">1</div>
          <div class="hint" id="totalDetail">1 pendaftar, 0 dewasa, 0 anak</div>
        </div>

        <!-- Section: Persetujuan -->
        <h3 class="section-title" id="sectionPersetujuan">
          <i class="fas fa-file-signature"></i> Persetujuan
        </h3>

        <!-- Consent -->
        <div class="consent">
          <input type="checkbox" id="consentCheckbox" required>
          <label for="consentCheckbox">
            <span class="consent-label-text" id="consentText">
              <strong>Data jamaah</strong> digunakan semata-mata untuk keperluan pendataan dan kelancaran pelaksanaan acara buka puasa bersama. Kami menjamin kerahasiaan data Anda.
            </span>
          </label>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="submit-btn" id="submitBtn" disabled>
          <span id="submitText">Daftar Sekarang</span>
        </button>

        <!-- Progress Indicator -->
        <div class="progress-indicator" id="progressIndicator">
          <div class="loading-spinner" style="display: inline-block; width: 20px; height: 20px;"></div>
          <div style="font-size: 0.9rem; color: var(--accent-teal); margin-top: 0.5rem;">
            Mengirim data...
          </div>
        </div>
      </form>
    </div>

    <!-- Footer -->
    <footer>
      <div class="prayer-message" id="prayerMessage">
        <i class="fas fa-star-and-crescent"></i>
        Semoga Allah menerima amal ibadah kita di bulan Ramadan yang mulia ini
      </div>
      
      <div id="footerCopyright">Â© 2026 â€” Masjid Central Okayama</div>
      
      <div class="contact">
        <span id="contactText">Untuk informasi lebih lanjut:</span>
        <a href="mailto:ibadurrahmanislamiccenter@gmail.com">
          ibadurrahmanislamiccenter@gmail.com
        </a>
      </div>
    </footer>
  </div>
</main>

<script>
// ============================================
// KONFIGURASI SISTEM - SAMA DENGAN ADMIN
// ============================================

const API_URL = "https://script.google.com/macros/s/AKfycbzZmeIcRGGskXXDLhhAVjL7cztMDEOgYYqwwe5knHcrClJ8Cyb3-pDMhaxqVRBmPkLi/exec";

// Deteksi bahasa
let lang = 'id';
const userLang = navigator.language || navigator.userLanguage;
if (userLang.startsWith('ja')) lang = 'ja';
else if (userLang.startsWith('en')) lang = 'en';

// State aplikasi
let isOTPVerified = false;
let otpTimer = null;
let otpCooldownSeconds = 0;
let registrationId = '';

// ============================================
// TRANSLATIONS
// ============================================

const translations = {
  id: {
    // Messages
    fillNameEmail: 'Mohon isi nama dan email terlebih dahulu',
    invalidEmail: 'Format email tidak valid',
    otpSent: 'Kode OTP telah dikirim ke email Anda',
    otpVerified: 'Kode OTP berhasil diverifikasi',
    invalidOtp: 'Kode OTP tidak valid',
    verifyOtpFirst: 'Mohon verifikasi kode OTP terlebih dahulu',
    processing: 'Memproses...',
    sendingOtp: 'Mengirim OTP...',
    success: 'Pendaftaran berhasil!',
    networkError: 'Terjadi kesalahan jaringan. Silakan coba lagi.',
    selectNationality: 'Mohon pilih kebangsaan',
    fillOtherNationality: 'Mohon isi kebangsaan Anda',
    consentRequired: 'Harap setujui persetujuan data',
    tooManyAttempts: 'Terlalu banyak percobaan OTP. Silakan refresh halaman.',
    emailConfirmed: 'Email sudah terkonfirmasi',
    duplicateData: 'Data ini sudah terdaftar',
    registrationComplete: 'Pendaftaran berhasil! Silakan cek email untuk konfirmasi.',
    
    // UI Text
    duplicateAlert: 'Data ini sudah terdaftar',
    infoMessage: 'Setelah submit, Anda akan diarahkan ke halaman konfirmasi',
    mainTitle: 'Registrasi Buka Puasa Bersama 1447 H',
    centerName: 'Masjid Central Okayama',
    subtitle: 'Silakan lengkapi formulir registrasi di bawah ini dengan data yang valid',
    eventPurpose: 'Formulir ini digunakan untuk pendataan jamaah agar pelaksanaan buka puasa bersama berjalan tertib, nyaman, dan penuh keberkahan',
    
    // Form labels
    namaLengkap: 'Nama Lengkap',
    namaPlaceholder: 'Nama sesuai identitas',
    email: 'Alamat Email',
    emailPlaceholder: 'contoh@email.com',
    sendOtp: 'Kirim OTP',
    hintEmail: 'Kode OTP akan dikirim ke email ini',
    otpCode: 'Kode OTP',
    otpPlaceholder: 'Masukkan 6 digit kode',
    otpHint: 'Periksa inbox atau spam folder email Anda',
    noHp: 'Nomor Telepon',
    noHpPlaceholder: '081234567890',
    hintNoHp: 'Gunakan nomor aktif yang dapat dihubungi',
    domisili: 'Domisili',
    domisiliPlaceholder: 'Cari nama kelurahan/kecamatan',
    kebangsaan: 'Kebangsaan',
    kebangsaanLainnya: 'Kebangsaan Lainnya',
    kebangsaanPlaceholder: 'Masukkan kebangsaan Anda',
    selectKebangsaan: 'Pilih kebangsaan',
    indonesia: 'Indonesia',
    jepang: 'Jepang',
    lainnya: 'Lainnya',
    usia: 'Usia',
    usiaPlaceholder: 'Usia saat ini',
    jenisKelamin: 'Jenis Kelamin',
    lakiLaki: 'Laki-laki',
    perempuan: 'Perempuan',
    sectionDataJamaah: 'Data Jamaah',
    sectionKehadiran: 'Informasi Kehadiran',
    dewasaTambahan: 'Dewasa Tambahan',
    dewasaPlaceholder: 'Jumlah dewasa selain Anda',
    hintDewasa: 'Usia 13 tahun ke atas',
    datangDenganAnak: 'Datang dengan Anak?',
    tidak: 'Tidak',
    ya: 'Ya',
    hintAnak: 'Anak usia 0-12 tahun',
    jumlahAnak: 'Jumlah Anak',
    hintUsiaAnak: 'Usia maksimal 12 tahun',
    sectionPersetujuan: 'Persetujuan',
    consentText: '<strong>Data jamaah</strong> digunakan semata-mata untuk keperluan pendataan dan kelancaran pelaksanaan acara buka puasa bersama. Kami menjamin kerahasiaan data Anda.',
    submit: 'Daftar Sekarang',
    
    // Footer
    prayerMessage: 'Semoga Allah menerima amal ibadah kita di bulan Ramadan yang mulia ini',
    footerCopyright: 'Â© 2026 â€” Masjid Central Okayama',
    contactText: 'Untuk informasi lebih lanjut:',
    totalLabel: 'Total yang akan hadir'
  },
  
  en: {
    // Messages
    fillNameEmail: 'Please fill in name and email first',
    invalidEmail: 'Invalid email format',
    otpSent: 'OTP code has been sent to your email',
    otpVerified: 'OTP code successfully verified',
    invalidOtp: 'Invalid OTP code',
    verifyOtpFirst: 'Please verify the OTP code first',
    processing: 'Processing...',
    sendingOtp: 'Sending OTP...',
    success: 'Registration successful!',
    networkError: 'Network error. Please try again.',
    selectNationality: 'Please select nationality',
    fillOtherNationality: 'Please enter your nationality',
    consentRequired: 'Please agree to the data consent',
    tooManyAttempts: 'Too many OTP attempts. Please refresh the page.',
    emailConfirmed: 'Email already confirmed',
    duplicateData: 'This data is already registered',
    registrationComplete: 'Registration successful! Please check your email for confirmation.',
    
    // UI Text
    duplicateAlert: 'This data is already registered',
    infoMessage: 'After submission, you will be redirected to the confirmation page',
    mainTitle: 'Ramadan Iftar Registration 1447 AH',
    centerName: 'Okayama Central Mosque',
    subtitle: 'Please complete the registration form below with valid data',
    eventPurpose: 'This form is used to register congregation members so that the iftar gathering runs orderly, comfortably, and full of blessings',
    
    // Form labels
    namaLengkap: 'Full Name',
    namaPlaceholder: 'Name as shown on ID',
    email: 'Email Address',
    emailPlaceholder: 'example@email.com',
    sendOtp: 'Send OTP',
    hintEmail: 'OTP code will be sent to this email',
    otpCode: 'OTP Code',
    otpPlaceholder: 'Enter 6-digit code',
    otpHint: 'Check your inbox or spam folder',
    noHp: 'Phone Number',
    noHpPlaceholder: '081234567890',
    hintNoHp: 'Use an active contact number',
    domisili: 'Residence',
    domisiliPlaceholder: 'Search for neighborhood/district',
    kebangsaan: 'Nationality',
    kebangsaanLainnya: 'Other Nationality',
    kebangsaanPlaceholder: 'Enter your nationality',
    selectKebangsaan: 'Select nationality',
    indonesia: 'Indonesia',
    jepang: 'Japan',
    lainnya: 'Other',
    usia: 'Age',
    usiaPlaceholder: 'Current age',
    jenisKelamin: 'Gender',
    lakiLaki: 'Male',
    perempuan: 'Female',
    sectionDataJamaah: 'Congregation Data',
    sectionKehadiran: 'Attendance Information',
    dewasaTambahan: 'Additional Adults',
    dewasaPlaceholder: 'Number of adults besides you',
    hintDewasa: 'Age 13 and above',
    datangDenganAnak: 'Coming with Children?',
    tidak: 'No',
    ya: 'Yes',
    hintAnak: 'Children age 0-12 years',
    jumlahAnak: 'Number of Children',
    hintUsiaAnak: 'Maximum age: 12 years',
    sectionPersetujuan: 'Consent',
    consentText: '<strong>Congregation data</strong> is used solely for registration purposes and the smooth implementation of the iftar gathering. We guarantee the confidentiality of your data.',
    submit: 'Register Now',
    
    // Footer
    prayerMessage: 'May Allah accept our worship in this blessed month of Ramadan',
    footerCopyright: 'Â© 2026 â€” Okayama Central Mosque',
    contactText: 'For more information:',
    totalLabel: 'Total attendees'
  },
  
  ja: {
    // Messages
    fillNameEmail: 'å…ˆã«åå‰ã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
    invalidEmail: 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒç„¡åŠ¹ã§ã™',
    otpSent: 'OTPã‚³ãƒ¼ãƒ‰ã‚’ãƒ¡ãƒ¼ãƒ«ã«é€ä¿¡ã—ã¾ã—ãŸ',
    otpVerified: 'OTPã‚³ãƒ¼ãƒ‰ãŒç¢ºèªã•ã‚Œã¾ã—ãŸ',
    invalidOtp: 'ç„¡åŠ¹ãªOTPã‚³ãƒ¼ãƒ‰ã§ã™',
    verifyOtpFirst: 'å…ˆã«OTPã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„',
    processing: 'å‡¦ç†ä¸­...',
    sendingOtp: 'OTPé€ä¿¡ä¸­...',
    success: 'ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼',
    networkError: 'é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚',
    selectNationality: 'å›½ç±ã‚’é¸æŠã—ã¦ãã ã•ã„',
    fillOtherNationality: 'å›½ç±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
    consentRequired: 'ãƒ‡ãƒ¼ã‚¿åŒæ„ã«åŒæ„ã—ã¦ãã ã•ã„',
    tooManyAttempts: 'OTPè©¦è¡Œå›æ•°ãŒå¤šã™ãã¾ã™ã€‚ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚',
    emailConfirmed: 'ãƒ¡ãƒ¼ãƒ«ã¯æ—¢ã«ç¢ºèªæ¸ˆã¿ã§ã™',
    duplicateData: 'ã™ã§ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™',
    registrationComplete: 'ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’ã”ç¢ºèªãã ã•ã„ã€‚',
    
    // UI Text
    duplicateAlert: 'ã™ã§ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™',
    infoMessage: 'é€ä¿¡å¾Œã€ç¢ºèªãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã¾ã™',
    mainTitle: '1447å¹´ ãƒ©ãƒãƒ€ãƒ³ãƒ»ã‚¤ãƒ•ã‚¿ãƒ¼ãƒ«å‚åŠ ç™»éŒ²',
    centerName: 'ã‚ªã‚«ãƒ¤ãƒã‚»ãƒ³ãƒˆãƒ©ãƒ«ãƒ¢ã‚¹ã‚¯',
    subtitle: 'æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ã§ä»¥ä¸‹ã®ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã«ã”è¨˜å…¥ãã ã•ã„',
    eventPurpose: 'ã“ã®ãƒ•ã‚©ãƒ¼ãƒ ã¯é›†å›£ã‚¤ãƒ•ã‚¿ãƒ¼ãƒ«ãŒç§©åºæ­£ã—ãã€å¿«é©ã«ã€ç¥ç¦ã«æº€ã¡ã¦è¡Œã‚ã‚Œã‚‹ã‚ˆã†ã€ç¤¼æ‹è€…ã®ç™»éŒ²ã«ä½¿ç”¨ã•ã‚Œã¾ã™',
    
    // Form labels
    namaLengkap: 'æ°å',
    namaPlaceholder: 'èº«åˆ†è¨¼é€šã‚Šã®æ°å',
    email: 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹',
    emailPlaceholder: 'ä¾‹: example@email.com',
    sendOtp: 'OTPé€ä¿¡',
    hintEmail: 'OTPã‚³ãƒ¼ãƒ‰ã¯ã“ã®ãƒ¡ãƒ¼ãƒ«ã«é€ä¿¡ã•ã‚Œã¾ã™',
    otpCode: 'OTPã‚³ãƒ¼ãƒ‰',
    otpPlaceholder: '6æ¡ã®ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›',
    otpHint: 'å—ä¿¡ãƒˆãƒ¬ã‚¤ã¾ãŸã¯ã‚¹ãƒ‘ãƒ ãƒ•ã‚©ãƒ«ãƒ€ã‚’ã”ç¢ºèªãã ã•ã„',
    noHp: 'é›»è©±ç•ªå·',
    noHpPlaceholder: '08012345678',
    hintNoHp: 'é€£çµ¡å¯èƒ½ãªç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
    domisili: 'å±…ä½åœ°',
    domisiliPlaceholder: 'ç”ºåãƒ»åœ°åŒºåã‚’æ¤œç´¢',
    kebangsaan: 'å›½ç±',
    kebangsaanLainnya: 'ãã®ä»–ã®å›½ç±',
    kebangsaanPlaceholder: 'å›½ç±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
    selectKebangsaan: 'å›½ç±ã‚’é¸æŠ',
    indonesia: 'ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢',
    jepang: 'æ—¥æœ¬',
    lainnya: 'ãã®ä»–',
    usia: 'å¹´é½¢',
    usiaPlaceholder: 'ç¾åœ¨ã®å¹´é½¢',
    jenisKelamin: 'æ€§åˆ¥',
    lakiLaki: 'ç”·æ€§',
    perempuan: 'å¥³æ€§',
    sectionDataJamaah: 'ç¤¼æ‹è€…ãƒ‡ãƒ¼ã‚¿',
    sectionKehadiran: 'å‚åŠ æƒ…å ±',
    dewasaTambahan: 'è¿½åŠ ã®å¤§äºº',
    dewasaPlaceholder: 'ã”æœ¬äººä»¥å¤–ã®å¤§äººã®äººæ•°',
    hintDewasa: '13æ­³ä»¥ä¸Š',
    datangDenganAnak: 'ãŠå­æ§˜ã¨ä¸€ç·’ã§ã™ã‹ï¼Ÿ',
    tidak: 'ã„ã„ãˆ',
    ya: 'ã¯ã„',
    hintAnak: '0ã€œ12æ­³ã®ãŠå­æ§˜',
    jumlahAnak: 'ãŠå­æ§˜ã®äººæ•°',
    hintUsiaAnak: 'æœ€å¤§12æ­³ã¾ã§',
    sectionPersetujuan: 'åŒæ„',
    consentText: '<strong>ç¤¼æ‹è€…ã®ãƒ‡ãƒ¼ã‚¿</strong>ã¯ã€ç™»éŒ²ç›®çš„ã¨é›†å›£ã‚¤ãƒ•ã‚¿ãƒ¼ãƒ«ã®å††æ»‘ãªå®Ÿæ–½ã®ãŸã‚ã«ã®ã¿ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ãŠå®¢æ§˜ã®ãƒ‡ãƒ¼ã‚¿ã®æ©Ÿå¯†æ€§ã‚’ä¿è¨¼ã—ã¾ã™ã€‚',
    submit: 'ä»Šã™ãç™»éŒ²',
    
    // Footer
    prayerMessage: 'ã‚¢ãƒƒãƒ©ãƒ¼ãŒã“ã®å°Šã„ãƒ©ãƒãƒ€ãƒ³æœˆã«ãŠã‘ã‚‹ç§ãŸã¡ã®ç¤¼æ‹ã‚’ãŠå—ã‘å…¥ã‚Œãã ã•ã„ã¾ã™ã‚ˆã†ã«',
    footerCopyright: 'Â© 2026 â€” ã‚ªã‚«ãƒ¤ãƒã‚»ãƒ³ãƒˆãƒ©ãƒ«ãƒ¢ã‚¹ã‚¯',
    contactText: 'è©³ç´°ã«ã¤ã„ã¦ã¯ï¼š',
    totalLabel: 'ç·å‚åŠ è€…æ•°'
  }
};

// ============================================
// FUNGSI UTILITAS
// ============================================

function getTranslation(key) {
  return translations[lang][key] || key;
}

function initMultilingual() {
  const t = translations[lang];
  
  // Update alert messages
  document.getElementById('duplicateAlertText').textContent = t.duplicateAlert;
  document.getElementById('infoMessageText').textContent = t.infoMessage;
  
  // Update header
  document.getElementById('mainTitle').textContent = t.mainTitle;
  document.getElementById('centerName').textContent = t.centerName;
  document.getElementById('subtitleText').textContent = t.subtitle;
  document.getElementById('eventPurpose').textContent = t.eventPurpose;
  
  // Update form labels
  document.getElementById('labelNamaLengkap').textContent = t.namaLengkap;
  document.getElementById('nama_lengkap').placeholder = t.namaPlaceholder;
  
  document.getElementById('labelEmail').textContent = t.email;
  document.getElementById('email').placeholder = t.emailPlaceholder;
  document.getElementById('sendOtpText').textContent = t.sendOtp;
  document.getElementById('hintEmail').textContent = t.hintEmail;
  
  document.getElementById('labelOtp').textContent = t.otpCode;
  document.getElementById('otp_input').placeholder = t.otpPlaceholder;
  document.getElementById('otpHint').textContent = t.otpHint;
  
  document.getElementById('labelNoHp').textContent = t.noHp;
  document.getElementById('no_hp').placeholder = t.noHpPlaceholder;
  document.getElementById('hintNoHp').textContent = t.hintNoHp;
  
  document.getElementById('labelDomisili').textContent = t.domisili;
  document.getElementById('domisili').placeholder = t.domisiliPlaceholder;
  
  document.getElementById('labelKebangsaan').textContent = t.kebangsaan;
  document.querySelector('#kebangsaan option[value=""]').textContent = t.selectKebangsaan;
  document.querySelector('#kebangsaan option[value="Indonesia"]').textContent = t.indonesia;
  document.querySelector('#kebangsaan option[value="Jepang"]').textContent = t.jepang;
  document.querySelector('#kebangsaan option[value="Lainnya"]').textContent = t.lainnya;
  
  document.getElementById('labelUsia').textContent = t.usia;
  document.getElementById('usia').placeholder = t.usiaPlaceholder;
  
  document.getElementById('labelJenisKelamin').textContent = t.jenisKelamin;
  document.getElementById('labelLakiLaki').textContent = t.lakiLaki;
  document.getElementById('labelPerempuan').textContent = t.perempuan;
  
  document.getElementById('sectionDataJamaah').textContent = t.sectionDataJamaah;
  document.getElementById('sectionKehadiran').textContent = t.sectionKehadiran;
  
  document.getElementById('labelDewasaTambahan').textContent = t.dewasaTambahan;
  document.getElementById('dewasa_tambahan').placeholder = t.dewasaPlaceholder;
  document.getElementById('hintDewasa').textContent = t.hintDewasa;
  
  document.getElementById('labelDatangDenganAnak').textContent = t.datangDenganAnak;
  document.getElementById('labelTidak').textContent = t.tidak;
  document.getElementById('labelYa').textContent = t.ya;
  document.getElementById('hintAnak').textContent = t.hintAnak;
  
  document.getElementById('labelJumlahAnak').textContent = t.jumlahAnak;
  document.getElementById('hintUsiaAnak').textContent = t.hintUsiaAnak;
  
  document.getElementById('sectionPersetujuan').textContent = t.sectionPersetujuan;
  document.getElementById('consentText').innerHTML = t.consentText;
  
  document.getElementById('submitText').textContent = t.submit;
  
  document.getElementById('prayerMessage').textContent = t.prayerMessage;
  document.getElementById('footerCopyright').textContent = t.footerCopyright;
  document.getElementById('contactText').textContent = t.contactText;
  
  document.getElementById('totalLabel').textContent = t.totalLabel;
  
  // Update total detail
  calculateTotal();
}

function calculateTotal() {
  const registrant = 1;
  const additionalAdults = parseInt(document.getElementById('dewasa_tambahan').value) || 0;
  let children = 0;
  
  const denganAnak = document.querySelector('input[name="dengan_anak"]:checked');
  if (denganAnak && denganAnak.value === 'Ya') {
    children = parseInt(document.getElementById('jumlah_anak').value) || 0;
  }
  
  const total = registrant + additionalAdults + children;
  
  // Update display
  document.getElementById('totalAttendees').textContent = total;
  
  // Update details
  const t = translations[lang];
  let details = '';
  if (lang === 'id') {
    details = `${registrant} pendaftar, ${additionalAdults} dewasa, ${children} anak`;
  } else if (lang === 'en') {
    details = `${registrant} registrant, ${additionalAdults} adults, ${children} children`;
  } else {
    details = `ç™»éŒ²è€…${registrant}åã€å¤§äºº${additionalAdults}åã€å­ä¾›${children}å`;
  }
  
  document.getElementById('totalDetail').textContent = details;
  
  return total;
}

function validateEmail(email) {
  const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return re.test(email);
}

function showAlert(type, message) {
  const alertDiv = document.getElementById(`${type}Message`);
  const textSpan = document.getElementById(`${type}MessageText`);
  
  if (alertDiv && textSpan) {
    textSpan.textContent = message;
    alertDiv.classList.add('active');
    
    // Auto hide after 5 seconds
    setTimeout(() => {
      alertDiv.classList.remove('active');
    }, 5000);
  }
}

function startOTPTimer() {
  let timeLeft = 60;
  const btn = document.getElementById('sendOtpBtn');
  btn.disabled = true;
  
  clearInterval(otpTimer);
  
  otpTimer = setInterval(() => {
    timeLeft--;
    btn.innerHTML = `<span>${timeLeft}s</span>`;
    
    if (timeLeft <= 0) {
      clearInterval(otpTimer);
      btn.disabled = false;
      btn.innerHTML = `<span id="sendOtpText">${getTranslation('sendOtp')}</span>`;
      initMultilingual();
    }
  }, 1000);
}

function resetOTPState() {
  isOTPVerified = false;
  const otpField = document.getElementById('otpField');
  const otpInput = document.getElementById('otp_input');
  
  otpField.classList.remove('active');
  otpInput.value = '';
  otpInput.disabled = false;
  otpInput.style.backgroundColor = '';
  document.getElementById('submitBtn').disabled = true;
  
  // Clear timer
  if (otpTimer) {
    clearInterval(otpTimer);
    document.getElementById('sendOtpBtn').disabled = false;
    document.getElementById('sendOtpBtn').innerHTML = `<span id="sendOtpText">${getTranslation('sendOtp')}</span>`;
    initMultilingual();
  }
}

function generateRegistrationId() {
  const prefix = 'IFTAR';
  const date = new Date();
  const dateStr = date.getFullYear().toString().slice(-2) + 
                  (date.getMonth() + 1).toString().padStart(2, '0') + 
                  date.getDate().toString().padStart(2, '0');
  const random = Math.random().toString(36).substr(2, 6).toUpperCase();
  return `${prefix}-${dateStr}-${random}`;
}

// ============================================
// FUNGSI API
// ============================================

async function sendOTP() {
  const email = document.getElementById('email').value.trim();
  const nama = document.getElementById('nama_lengkap').value.trim();
  
  if (!email || !nama) {
    showAlert('alert', getTranslation('fillNameEmail'));
    return;
  }
  
  if (!validateEmail(email)) {
    showAlert('alert', getTranslation('invalidEmail'));
    return;
  }
  
  const btn = document.getElementById('sendOtpBtn');
  btn.disabled = true;
  btn.innerHTML = `<span class="loading-spinner"></span> ${getTranslation('sendingOtp')}`;
  
  try {
    const response = await fetch(`${API_URL}?action=send_otp&email=${encodeURIComponent(email.toLowerCase())}&nama=${encodeURIComponent(nama)}&lang=${lang}`);
    const result = await response.json();
    
    if (result.success) {
      // Show OTP field
      document.getElementById('otpField').classList.add('active');
      showAlert('success', getTranslation('otpSent'));
      
      // Start cooldown timer
      startOTPTimer();
      
      // Auto-focus OTP input
      setTimeout(() => {
        document.getElementById('otp_input').focus();
      }, 300);
      
    } else {
      showAlert('alert', result.error || getTranslation('networkError'));
      btn.disabled = false;
      btn.innerHTML = `<span id="sendOtpText">${getTranslation('sendOtp')}</span>`;
      initMultilingual();
    }
  } catch (error) {
    showAlert('alert', getTranslation('networkError'));
    btn.disabled = false;
    btn.innerHTML = `<span id="sendOtpText">${getTranslation('sendOtp')}</span>`;
    initMultilingual();
  }
}

async function verifyOTP() {
  const otp = document.getElementById('otp_input').value;
  const email = document.getElementById('email').value;
  
  if (otp.length !== 6) return;
  
  try {
    const response = await fetch(`${API_URL}?action=verify_otp&email=${encodeURIComponent(email.toLowerCase())}&otp=${otp}`);
    const result = await response.json();
    
    if (result.success) {
      isOTPVerified = true;
      document.getElementById('otp_input').disabled = true;
      document.getElementById('otp_input').style.backgroundColor = '#f0fdf4';
      showAlert('success', getTranslation('otpVerified'));
      document.getElementById('submitBtn').disabled = false;
      
      // Check for duplicate
      await checkDuplicate();
    } else {
      showAlert('alert', getTranslation('invalidOtp'));
    }
  } catch (error) {
    showAlert('alert', getTranslation('networkError'));
  }
}

async function checkDuplicate() {
  const email = document.getElementById('email').value.trim().toLowerCase();
  const phone = document.getElementById('no_hp').value.trim();
  
  if (!email || !phone) return;
  
  try {
    const response = await fetch(`${API_URL}?action=check_duplicate&email=${encodeURIComponent(email)}&no_hp=${encodeURIComponent(phone)}`);
    const result = await response.json();
    
    if (result.isDuplicate) {
      document.getElementById('duplicateAlert').classList.add('active');
      document.getElementById('submitBtn').disabled = true;
    } else {
      document.getElementById('duplicateAlert').classList.remove('active');
      document.getElementById('submitBtn').disabled = false;
    }
  } catch (error) {
    console.error('Duplicate check error:', error);
  }
}

async function submitRegistration(formData) {
  try {
    // Generate registration ID
    registrationId = generateRegistrationId();
    formData.registration_id = registrationId;
    formData.status = 'Menunggu';
    formData.checkin_time = '';
    
    // Submit to Google Apps Script
    const params = new URLSearchParams();
    for (const key in formData) {
      params.append(key, formData[key]);
    }
    params.append('action', 'register');
    params.append('lang_used', lang);
    
    const response = await fetch(API_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: params
    });
    
    const result = await response.json();
    return result;
    
  } catch (error) {
    console.error('Submission error:', error);
    return { success: false, error: getTranslation('networkError') };
  }
}

// ============================================
// EVENT HANDLERS
// ============================================

async function handleFormSubmit(e) {
  e.preventDefault();
  
  if (!isOTPVerified) {
    showAlert('alert', getTranslation('verifyOtpFirst'));
    document.getElementById('otp_input').focus();
    return;
  }
  
  // Validate nationality
  const selectedNationality = document.getElementById('kebangsaan').value;
  if (!selectedNationality) {
    showAlert('alert', getTranslation('selectNationality'));
    document.getElementById('kebangsaan').focus();
    return;
  }
  
  // Validate other nationality
  if (selectedNationality === 'Lainnya') {
    const otherNationality = document.getElementById('kebangsaan_lainnya').value.trim();
    if (!otherNationality) {
      showAlert('alert', getTranslation('fillOtherNationality'));
      document.getElementById('kebangsaan_lainnya').focus();
      return;
    }
  }
  
  // Check consent
  if (!document.getElementById('consentCheckbox').checked) {
    showAlert('alert', getTranslation('consentRequired'));
    document.getElementById('consentCheckbox').focus();
    return;
  }
  
  // Prepare form data
  const form = document.getElementById('registrationForm');
  const formData = new FormData(form);
  const data = {};
  
  for (const [key, value] of formData.entries()) {
    data[key] = value.toString().trim();
  }
  
  // Handle nationality
  if (data.kebangsaan === 'Lainnya') {
    data.kebangsaan = document.getElementById('kebangsaan_lainnya').value.trim();
  }
  
  // Calculate total
  data.total_kehadiran = calculateTotal();
  data.total = data.total_kehadiran; // For compatibility with admin
  
  // Show loading
  document.getElementById('submitBtn').disabled = true;
  document.getElementById('progressIndicator').classList.add('active');
  document.getElementById('submitBtn').innerHTML = `<span class="loading-spinner"></span> ${getTranslation('processing')}`;
  
  try {
    const result = await submitRegistration(data);
    
    if (result.success) {
      // Show success message
      showAlert('success', getTranslation('registrationComplete'));
      
      // Redirect to success page
      setTimeout(() => {
        const params = new URLSearchParams({
          id: registrationId,
          nama: encodeURIComponent(data.nama_lengkap),
          email: encodeURIComponent(data.email),
          total: data.total_kehadiran,
          phone: encodeURIComponent(data.no_hp),
          domisili: encodeURIComponent(data.domisili)
        }).toString();
        
        window.location.href = `success.html?${params}`;
      }, 2000);
      
    } else {
      showAlert('alert', result.error || getTranslation('networkError'));
      document.getElementById('submitBtn').disabled = false;
      document.getElementById('progressIndicator').classList.remove('active');
      document.getElementById('submitBtn').innerHTML = `<span id="submitText">${getTranslation('submit')}</span>`;
      initMultilingual();
    }
  } catch (error) {
    showAlert('alert', getTranslation('networkError'));
    document.getElementById('submitBtn').disabled = false;
    document.getElementById('progressIndicator').classList.remove('active');
    document.getElementById('submitBtn').innerHTML = `<span id="submitText">${getTranslation('submit')}</span>`;
    initMultilingual();
  }
}

// ============================================
// INISIALISASI
// ============================================

document.addEventListener('DOMContentLoaded', function() {
  // Initialize multilingual
  initMultilingual();
  
  // Show info message
  document.getElementById('infoMessage').classList.add('active');
  
  // Set initial language selector
  document.getElementById('languageSelector').value = lang;
  
  // Setup event listeners
  setupEventListeners();
  
  // Calculate initial total
  calculateTotal();
});

function setupEventListeners() {
  // Language selector
  document.getElementById('languageSelector').addEventListener('change', function(e) {
    lang = e.target.value;
    initMultilingual();
  });
  
  // Email validation for OTP button
  document.getElementById('email').addEventListener('input', function() {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    document.getElementById('sendOtpBtn').disabled = !emailRegex.test(this.value.trim());
    
    // Reset OTP state when email changes
    resetOTPState();
  });
  
  // Send OTP
  document.getElementById('sendOtpBtn').addEventListener('click', sendOTP);
  
  // Verify OTP on input
  let otpVerifyTimeout;
  document.getElementById('otp_input').addEventListener('input', function() {
    clearTimeout(otpVerifyTimeout);
    otpVerifyTimeout = setTimeout(() => {
      if (this.value.length === 6) {
        verifyOTP();
      }
    }, 500);
  });
  
  // Nationality selection
  document.getElementById('kebangsaan').addEventListener('change', function(e) {
    const otherWrapper = document.getElementById('otherNationalityWrapper');
    otherWrapper.classList.toggle('active', e.target.value === 'Lainnya');
  });
  
  // Children toggle
  document.querySelectorAll('input[name="dengan_anak"]').forEach(radio => {
    radio.addEventListener('change', function() {
      const childrenWrapper = document.getElementById('childrenFieldWrapper');
      childrenWrapper.classList.toggle('active', this.value === 'Ya');
      calculateTotal();
    });
  });
  
  // Real-time calculations
  document.getElementById('dewasa_tambahan').addEventListener('input', calculateTotal);
  document.getElementById('jumlah_anak').addEventListener('input', calculateTotal);
  
  // Duplicate check
  document.getElementById('email').addEventListener('blur', checkDuplicate);
  document.getElementById('no_hp').addEventListener('blur', checkDuplicate);
  
  // Form submission
  document.getElementById('registrationForm').addEventListener('submit', handleFormSubmit);
}
</script>
</body>
</html>
