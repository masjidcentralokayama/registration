[file name]: index.html
[file content begin]
<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Registrasi Buka Puasa Bersama 1447 H</title>

<!-- Apps Script Deployment URL -->
<meta name="script-url" content="https://script.google.com/macros/s/AKfycbwgEEpMk2LyBCdtfJMoEnj_BSYrVvaY6DQxbg1Y7O0frE-S1zpPJT9xIiz5k0dWdipb/exec">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&family=Open+Sans:wght@400;500;600&display=swap" rel="stylesheet">

<style>
/* RESET & BASE STYLES */
:root {
  --accent-green: #10a37f;
  --accent-gold: #d4af37;
  --accent-teal: #0f766e;
  --accent-dark: #1e293b;
  --accent-light: #f8fafc;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Poppins', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  background: linear-gradient(135deg, #f7f7f8 0%, #f0f9ff 100%);
  color: var(--accent-dark);
  line-height: 1.6;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

main {
  padding: 2rem 1rem;
  position: relative;
  overflow: hidden;
}

.container {
  max-width: 520px;
  margin: 0 auto;
  position: relative;
  z-index: 1;
}

/* DECORATIVE ELEMENTS */
.ornament-top {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 120px;
  background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-teal) 100%);
  clip-path: polygon(0 0, 100% 0, 100% 70%, 0 100%);
  z-index: 0;
  opacity: 0.9;
}

.ornament-bottom {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 80px;
  background: linear-gradient(135deg, var(--accent-teal) 0%, var(--accent-green) 100%);
  clip-path: polygon(0 30%, 100% 0, 100% 100%, 0 100%);
  z-index: 0;
  opacity: 0.9;
}

.islamic-pattern {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-image: 
    radial-gradient(circle at 10% 10%, rgba(16, 163, 127, 0.05) 1px, transparent 1px),
    radial-gradient(circle at 90% 90%, rgba(212, 175, 55, 0.05) 1px, transparent 1px);
  background-size: 30px 30px;
  z-index: 0;
}

/* HEADER STYLES */
.header {
  text-align: center;
  margin-bottom: 2.5rem;
  padding: 0 0.5rem;
  position: relative;
}

.header-icon {
  width: 80px;
  height: 80px;
  background: white;
  border-radius: 50%;
  margin: 0 auto 1.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 20px rgba(16, 163, 127, 0.15);
  border: 2px solid var(--accent-gold);
  position: relative;
  overflow: hidden;
}

.header-icon i {
  font-size: 2.5rem;
  color: var(--accent-green);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.header h1 {
  margin: 0 0 1rem 0;
  font-size: 1.9rem;
  color: var(--accent-dark);
  font-weight: 700;
  letter-spacing: -0.01em;
  line-height: 1.3;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  position: relative;
  display: inline-block;
}

.header h1::after {
  content: '';
  position: absolute;
  bottom: -10px;
  left: 50%;
  transform: translateX(-50%);
  width: 100px;
  height: 3px;
  background: linear-gradient(90deg, transparent, var(--accent-gold), transparent);
  border-radius: 2px;
}

.header .center-name {
  color: var(--accent-teal);
  font-weight: 600;
  font-size: 1.1rem;
  margin-bottom: 1rem;
  font-family: 'Poppins', sans-serif;
}

.header .subtitle {
  color: #64748b;
  font-size: 0.95rem;
  font-weight: 400;
  line-height: 1.6;
  margin-bottom: 1rem;
  max-width: 480px;
  margin-left: auto;
  margin-right: auto;
}

.event-purpose {
  background: linear-gradient(135deg, rgba(16, 163, 127, 0.08) 0%, rgba(15, 118, 110, 0.08) 100%);
  border-radius: 12px;
  padding: 1rem 1.25rem;
  margin: 1.5rem auto 0;
  max-width: 480px;
  border-left: 4px solid var(--accent-gold);
  font-size: 0.9rem;
  color: var(--accent-teal);
  line-height: 1.6;
  font-style: italic;
  text-align: center;
  box-shadow: 0 2px 8px rgba(16, 163, 127, 0.1);
}

.islamic-divider {
  text-align: center;
  margin: 1.5rem 0;
  position: relative;
}

.islamic-divider::before,
.islamic-divider::after {
  content: '';
  position: absolute;
  top: 50%;
  width: 30%;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--accent-gold), transparent);
}

.islamic-divider::before {
  left: 0;
}

.islamic-divider::after {
  right: 0;
}

.islamic-divider span {
  color: var(--accent-gold);
  font-size: 1.2rem;
  letter-spacing: 8px;
  display: inline-block;
  padding: 0 10px;
  background: var(--accent-light);
}

/* CARD STYLES */
.card {
  background: #ffffff;
  padding: 2.5rem;
  border-radius: 16px;
  border: 1px solid #e2e8f0;
  box-shadow: 0 8px 32px rgba(16, 163, 127, 0.08);
  margin-bottom: 2.5rem;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 4px;
  height: 100%;
  background: linear-gradient(180deg, var(--accent-green), var(--accent-gold));
}

.card:hover {
  box-shadow: 0 12px 40px rgba(16, 163, 127, 0.12);
  transform: translateY(-2px);
}

/* SECTION TITLES */
.section-title {
  font-size: 0.95rem;
  color: var(--accent-teal);
  border-left: 3px solid var(--accent-gold);
  padding-left: 1rem;
  margin: 2.5rem 0 1.5rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-family: 'Poppins', sans-serif;
  position: relative;
  padding-top: 0.25rem;
  padding-bottom: 0.25rem;
}

.section-title:first-child {
  margin-top: 0;
}

.section-title::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: linear-gradient(180deg, var(--accent-green), var(--accent-gold));
  border-radius: 2px;
}

/* FORM FIELD STYLES */
.field {
  margin-bottom: 1.75rem;
  position: relative;
}

label {
  display: block;
  margin-bottom: 0.75rem;
  font-weight: 600;
  font-size: 0.9rem;
  color: var(--accent-dark);
  letter-spacing: -0.01em;
  font-family: 'Poppins', sans-serif;
}

.input-wrapper {
  position: relative;
  transition: all 0.3s ease;
}

.input-wrapper:hover {
  transform: translateY(-1px);
}

.input-wrapper i {
  position: absolute;
  left: 1rem;
  top: 50%;
  transform: translateY(-50%);
  color: #94a3b8;
  font-size: 1rem;
  transition: color 0.3s ease;
}

input:focus + i,
select:focus + i {
  color: var(--accent-green);
}

input, select {
  width: 100%;
  padding: 1rem 1rem 1rem 3rem;
  border-radius: 10px;
  border: 1.5px solid #e2e8f0;
  font-size: 0.95rem;
  font-family: 'Inter', sans-serif;
  background: #ffffff;
  transition: all 0.3s ease;
  color: var(--accent-dark);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
}

input:focus, select:focus {
  outline: none;
  border-color: var(--accent-green);
  box-shadow: 0 0 0 3px rgba(16, 163, 127, 0.15);
  background: #ffffff;
}

/* SELECT STYLES */
select {
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2394a3b8'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 1rem center;
  background-size: 1.25rem;
  padding-right: 3rem;
  cursor: pointer;
}

/* RADIO & TOGGLE BUTTON STYLES */
.radio-group, .toggle-group {
  display: flex;
  gap: 0.75rem;
}

.radio-group input, .toggle-group input {
  display: none;
}

.radio-group label, .toggle-group label {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 1rem 1.25rem;
  border-radius: 10px;
  border: 1.5px solid #e2e8f0;
  background: #f8fafc;
  font-size: 0.9rem;
  font-weight: 500;
  color: #475569;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-bottom: 0;
}

.radio-group label i, .toggle-group label i {
  position: static;
  transform: none;
  font-size: 1rem;
}

.radio-group input:checked + label,
.toggle-group input:checked + label {
  background: rgba(16, 163, 127, 0.1);
  border-color: var(--accent-green);
  color: var(--accent-teal);
  font-weight: 600;
  box-shadow: 0 4px 8px rgba(16, 163, 127, 0.1);
}

/* OTP CONTAINER */
.otp-container {
  display: flex;
  gap: 0.75rem;
  align-items: center;
}

.otp-container .input-wrapper {
  flex: 1;
}

.btn-otp {
  padding: 1rem 1.5rem;
  background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-teal) 100%);
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.3s ease;
  font-family: 'Poppins', sans-serif;
  min-width: 120px;
  box-shadow: 0 4px 12px rgba(16, 163, 127, 0.2);
}

.btn-otp:hover {
  background: linear-gradient(135deg, var(--accent-teal) 0%, var(--accent-green) 100%);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(16, 163, 127, 0.3);
}

.btn-otp:disabled {
  background: #cbd5e1;
  transform: none;
  box-shadow: none;
  cursor: not-allowed;
}

/* HINT TEXT */
.hint {
  font-size: 0.8rem;
  color: #64748b;
  margin-top: 0.5rem;
  line-height: 1.5;
  padding-left: 0.25rem;
}

/* ROW LAYOUT */
.row {
  display: flex;
  gap: 1rem;
}

.row .field {
  flex: 1;
}

/* OTP FIELD */
.otp-field {
  display: none;
  background: linear-gradient(135deg, rgba(16, 163, 127, 0.05) 0%, rgba(15, 118, 110, 0.05) 100%);
  padding: 1.25rem;
  border-radius: 12px;
  border: 1.5px dashed var(--accent-green);
  margin-bottom: 1.75rem;
  position: relative;
  overflow: hidden;
}

.otp-field::before {
  content: '✓';
  position: absolute;
  top: 10px;
  right: 10px;
  color: var(--accent-green);
  font-size: 1.2rem;
  font-weight: bold;
  opacity: 0.3;
}

.otp-field.active {
  display: block;
  animation: slideDown 0.3s ease;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* OTHER NATIONALITY FIELD */
.other-nationality-wrapper {
  display: none;
  margin-top: 1rem;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.other-nationality-wrapper.active {
  display: block;
}

/* CHILDREN FIELD */
.children-field-wrapper {
  display: none;
  margin-top: 1rem;
  animation: fadeIn 0.3s ease;
}

.children-field-wrapper.active {
  display: block;
}

/* TOTAL SUMMARY */
.total-summary {
  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  border: 1.5px solid #e2e8f0;
  border-radius: 12px;
  padding: 1.75rem;
  margin-top: 2rem;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.total-summary::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--accent-green), var(--accent-gold), var(--accent-teal));
}

.total-number {
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--accent-teal);
  margin: 0.5rem 0;
  font-family: 'Poppins', sans-serif;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.total-label {
  font-size: 0.9rem;
  color: var(--accent-dark);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  font-weight: 600;
  margin-bottom: 0.75rem;
}

.total-label i {
  color: var(--accent-green);
  font-size: 1.2rem;
}

/* CONSENT CHECKBOX */
.consent {
  display: flex;
  gap: 1rem;
  padding: 1.5rem;
  background: linear-gradient(135deg, rgba(16, 163, 127, 0.05) 0%, rgba(15, 118, 110, 0.05) 100%);
  border: 1.5px solid #e2e8f0;
  border-radius: 12px;
  margin: 2rem 0;
  align-items: flex-start;
  transition: all 0.3s ease;
}

.consent:hover {
  border-color: var(--accent-green);
  background: linear-gradient(135deg, rgba(16, 163, 127, 0.08) 0%, rgba(15, 118, 110, 0.08) 100%);
}

.consent input {
  width: 1.5rem;
  height: 1.5rem;
  margin-top: 0.125rem;
  flex-shrink: 0;
  border-radius: 6px;
  accent-color: var(--accent-green);
  cursor: pointer;
}

.consent span {
  font-size: 0.9rem;
  color: var(--accent-dark);
  line-height: 1.6;
  font-weight: 500;
}

.consent span strong {
  color: var(--accent-teal);
  font-weight: 600;
}

/* BUTTON */
.submit-btn {
  width: 100%;
  padding: 1.25rem;
  background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-teal) 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  font-family: 'Poppins', sans-serif;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  box-shadow: 0 6px 20px rgba(16, 163, 127, 0.2);
  position: relative;
  overflow: hidden;
}

.submit-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s ease;
}

.submit-btn:hover {
  background: linear-gradient(135deg, var(--accent-teal) 0%, var(--accent-green) 100%);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(16, 163, 127, 0.3);
}

.submit-btn:hover::before {
  left: 100%;
}

.submit-btn:disabled {
  background: #cbd5e1;
  transform: none;
  box-shadow: none;
  cursor: not-allowed;
}

.submit-btn:disabled::before {
  display: none;
}

/* ALERT */
.alert {
  display: none;
  background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
  color: #dc2626;
  padding: 1.25rem;
  border-radius: 12px;
  border: 1.5px solid #fecaca;
  margin-bottom: 1.75rem;
  text-align: center;
  font-size: 0.9rem;
  font-weight: 500;
  animation: slideDown 0.3s ease;
}

.alert.active {
  display: block;
}

/* INFO MESSAGE */
.info-message {
  display: none;
  background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
  color: #0369a1;
  padding: 1.25rem;
  border-radius: 12px;
  border: 1.5px solid #bae6fd;
  margin-bottom: 1.75rem;
  text-align: center;
  font-size: 0.9rem;
  font-weight: 500;
  animation: slideDown 0.3s ease;
}

.info-message.active {
  display: block;
}

/* FOOTER */
footer {
  text-align: center;
  color: #64748b;
  font-size: 0.85rem;
  padding: 1.5rem 0;
  border-top: 1px solid #e2e8f0;
  margin-top: 3rem;
  position: relative;
}

.prayer-message {
  background: linear-gradient(135deg, rgba(212, 175, 55, 0.08) 0%, rgba(16, 163, 127, 0.08) 100%);
  border-radius: 12px;
  padding: 1rem 1.5rem;
  margin: 1rem auto 1.5rem;
  max-width: 500px;
  color: var(--accent-teal);
  font-style: italic;
  line-height: 1.6;
  font-size: 0.9rem;
  border: 1px solid rgba(212, 175, 55, 0.2);
}

footer .center-name {
  font-weight: 600;
  color: var(--accent-teal);
  margin-bottom: 0.5rem;
  font-size: 0.9rem;
}

footer .contact {
  margin-top: 0.75rem;
  font-size: 0.8rem;
  color: #94a3b8;
}

footer .contact a {
  color: var(--accent-green);
  text-decoration: none;
  transition: color 0.3s ease;
}

footer .contact a:hover {
  color: var(--accent-teal);
  text-decoration: underline;
}

/* RESPONSIVE */
@media (max-width: 640px) {
  main {
    padding: 1.5rem 1rem;
  }
  
  .card {
    padding: 1.75rem;
  }
  
  .row {
    flex-direction: column;
    gap: 1rem;
  }
  
  .otp-container {
    flex-direction: column;
    gap: 1rem;
    align-items: stretch;
  }
  
  .btn-otp {
    width: 100%;
    padding: 0.9rem;
    font-size: 0.85rem;
    min-width: unset;
  }
  
  .otp-container .input-wrapper {
    width: 100%;
  }
  
  input, select {
    padding: 0.9rem 1rem 0.9rem 2.75rem;
    font-size: 0.9rem;
  }
  
  .input-wrapper i {
    left: 0.875rem;
    font-size: 0.9rem;
  }
  
  .otp-field {
    padding: 1rem;
  }
  
  .total-summary {
    padding: 1.5rem;
  }
  
  .total-number {
    font-size: 2.2rem;
  }
  
  .header h1 {
    font-size: 1.7rem;
  }
  
  .header-icon {
    width: 70px;
    height: 70px;
  }
  
  .header-icon i {
    font-size: 2rem;
  }
  
  .section-title {
    margin: 2rem 0 1.25rem;
  }
}

/* LOADING SPINNER */
.loading-spinner {
  display: inline-block;
  width: 1.2rem;
  height: 1.2rem;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: #fff;
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}
</style>
</head>

<body>
<!-- Decorative Background Elements -->
<div class="ornament-top"></div>
<div class="ornament-bottom"></div>
<div class="islamic-pattern"></div>

<main>
  <div class="container">
    <!-- Duplicate Alert -->
    <div class="alert" id="duplicateAlert">
      <span data-id="Data ini sudah terdaftar" 
            data-en="This data is already registered" 
            data-ja="すでに登録されています"></span>
    </div>

    <!-- Info Message -->
    <div class="info-message" id="infoMessage">
      <span data-id="Setelah submit, Anda akan menerima email konfirmasi jika data valid"
            data-en="After submission, you will receive a confirmation email if the data is valid"
            data-ja="送信後、データが有効な場合、確認メールが送信されます"></span>
    </div>

    <!-- Header -->
    <div class="header">
      <div class="header-icon">
        <i class="fas fa-mosque"></i>
      </div>
      
      <h1 data-id="Registrasi Buka Puasa Bersama 1447 H"
          data-en="Ramadan Iftar Registration 1447 AH"
          data-ja="1447年 ラマダン・イフタール参加登録"></h1>
      
      <div class="center-name" 
           data-id="Yayasan Ibadurrahman Islamic Center"
           data-en="Ibadurrahman Islamic Center Foundation"
           data-ja="イバドゥッラフマン・イスラムセンター財団"></div>
      
      <div class="subtitle"
           data-id="Silakan lengkapi formulir registrasi di bawah ini dengan data yang valid"
           data-en="Please complete the registration form below with valid data"
           data-ja="有効なデータで以下の登録フォームにご記入ください"></div>
      
      <div class="event-purpose"
           data-id="Formulir ini digunakan untuk pendataan jamaah agar pelaksanaan buka puasa bersama berjalan tertib, nyaman, dan penuh keberkahan"
           data-en="This form is used to register congregation members so that the iftar gathering runs orderly, comfortably, and full of blessings"
           data-ja="このフォームは集団イフタールが秩序正しく、快適に、祝福に満ちて行われるよう、礼拝者の登録に使用されます"></div>
    </div>

    <!-- Islamic Divider -->
    <div class="islamic-divider">
      <span>✦ ✦ ✦</span>
    </div>

    <!-- Registration Form -->
    <div class="card">
      <form id="registrationForm">
        
        <!-- Section: Data Jamaah -->
        <h3 class="section-title" 
            data-id="Data Jamaah"
            data-en="Congregation Data"
            data-ja="礼拝者データ"></h3>

        <!-- Full Name -->
        <div class="field">
          <label data-id="Nama Lengkap" data-en="Full Name" data-ja="氏名"></label>
          <div class="input-wrapper">
            <i class="fas fa-user"></i>
            <input type="text" id="nama_lengkap" name="nama_lengkap" required
                   data-id-ph="Nama sesuai identitas"
                   data-en-ph="Name as shown on ID"
                   data-ja-ph="身分証通りの氏名">
          </div>
        </div>

        <!-- Email -->
        <div class="field">
          <label data-id="Alamat Email" data-en="Email Address" data-ja="メールアドレス"></label>
          <div class="otp-container">
            <div class="input-wrapper">
              <i class="fas fa-envelope"></i>
              <input type="email" id="email" name="email" required
                     data-id-ph="contoh@email.com"
                     data-en-ph="example@email.com"
                     data-ja-ph="例: example@email.com">
            </div>
            <button type="button" class="btn-otp" id="sendOtpBtn" aria-label="Send OTP" disabled>
              <span data-id="Kirim OTP" data-en="Send OTP" data-ja="OTP送信"></span>
            </button>
          </div>
          <div class="hint"
               data-id="Kode OTP akan dikirim ke email ini"
               data-en="OTP code will be sent to this email"
               data-ja="OTPコードはこのメールに送信されます"></div>
        </div>

        <!-- OTP Field -->
        <div class="otp-field" id="otpField">
          <label data-id="Kode OTP" data-en="OTP Code" data-ja="OTPコード"></label>
          <div class="input-wrapper">
            <i class="fas fa-key"></i>
            <input type="tel" id="otp_input" inputmode="numeric" pattern="[0-9]{6}" maxlength="6"
                   data-id-ph="Masukkan 6 digit kode"
                   data-en-ph="Enter 6-digit code"
                   data-ja-ph="6桁のコードを入力">
          </div>
          <div class="hint" id="otpHint"
               data-id="Periksa inbox atau spam folder email Anda"
               data-en="Check your inbox or spam folder"
               data-ja="受信トレイまたはスパムフォルダをご確認ください"></div>
        </div>

        <!-- Phone Number -->
        <div class="field">
          <label data-id="Nomor Telepon" data-en="Phone Number" data-ja="電話番号"></label>
          <div class="input-wrapper">
            <i class="fas fa-phone"></i>
            <input type="tel" id="no_hp" name="no_hp" required pattern="[0-9]{10,15}" inputmode="numeric"
                   data-id-ph="081234567890"
                   data-en-ph="081234567890"
                   data-ja-ph="08012345678">
          </div>
          <div class="hint"
               data-id="Gunakan nomor aktif yang dapat dihubungi"
               data-en="Use an active contact number"
               data-ja="連絡可能な番号を入力してください"></div>
        </div>

        <!-- Residence -->
        <div class="field">
          <label data-id="Domisili" data-en="Residence" data-ja="居住地"></label>
          <div class="input-wrapper">
            <i class="fas fa-map-marker-alt"></i>
            <input type="text" id="domisili" name="domisili" list="neighborhoods" required autocomplete="off"
                   data-id-ph="Cari nama kelurahan/kecamatan"
                   data-en-ph="Search for neighborhood/district"
                   data-ja-ph="町名・地区名を検索">
            <datalist id="neighborhoods">
              <option value="Okayama-shi, Kita-ku, Kaminakano">
              <option value="Okayama-shi, Kita-ku, Ima">
              <option value="Okayama-shi, Kita-ku, Omoto">
              <option value="Okayama-shi, Kita-ku, Tsushima">
              <option value="Okayama-shi, Kita-ku, Hokan-cho">
              <option value="Okayama-shi, Naka-ku, Nishigawara">
              <option value="Okayama-shi, Minami-ku, Toyonari">
              <option value="Kurashiki-shi, Achi">
              <option value="Kurashiki-shi, Nakasho">
              <option value="Kurashiki-shi, Chaya-machi">
              <option value="Kurashiki-shi, Mizushima">
              <option value="Kurashiki-shi, Kojima">
              <option value="Kurashiki-shi, Tamashima">
              <option value="Tamano-shi, Chikko">
              <option value="Tamano-shi, Uno">
              <option value="Tamano-shi, Hibibi">
              <option value="Tamano-shi, Shibukawa">
              <option value="Soja-shi, Chuo">
              <option value="Soja-shi, Kiyone">
              <option value="Soja-shi, Yamate">
              <option value="Akaiwa-shi, Sanyo">
              <option value="Setouchi-shi, Oku-cho">
            </datalist>
          </div>
        </div>

        <!-- Nationality -->
        <div class="field">
          <label data-id="Kebangsaan" data-en="Nationality" data-ja="国籍"></label>
          <div class="input-wrapper">
            <i class="fas fa-globe"></i>
            <select id="kebangsaan" name="kebangsaan" required>
              <option value=""
                      data-id="Pilih kebangsaan"
                      data-en="Select nationality"
                      data-ja="国籍を選択">
              </option>
              <option value="Indonesia"
                      data-id="Indonesia"
                      data-en="Indonesia"
                      data-ja="インドネシア">
              </option>
              <option value="Jepang"
                      data-id="Jepang"
                      data-en="Japan"
                      data-ja="日本">
              </option>
              <option value="Lainnya"
                      data-id="Lainnya"
                      data-en="Other"
                      data-ja="その他">
              </option>
            </select>
          </div>

          <!-- Other Nationality Input -->
          <div class="other-nationality-wrapper" id="otherNationalityWrapper">
            <div class="input-wrapper">
              <i class="fas fa-edit"></i>
              <input type="text"
                     id="kebangsaan_lainnya"
                     name="kebangsaan_lainnya"
                     data-id-ph="Masukkan kebangsaan Anda"
                     data-en-ph="Enter your nationality"
                     data-ja-ph="国籍を入力してください"
                     autocapitalize="words">
            </div>
          </div>
        </div>

        <!-- Age & Gender -->
        <div class="row">
          <div class="field">
            <label data-id="Usia" data-en="Age" data-ja="年齢"></label>
            <div class="input-wrapper">
              <i class="fas fa-birthday-cake"></i>
              <input type="number" id="usia" name="usia" min="1" max="120" required inputmode="numeric"
                     data-id-ph="Usia saat ini"
                     data-en-ph="Current age"
                     data-ja-ph="現在の年齢">
            </div>
          </div>

          <div class="field">
            <label data-id="Jenis Kelamin" data-en="Gender" data-ja="性別"></label>
            <div class="radio-group">
              <input type="radio" id="jk_l" name="jk" value="Laki-laki" required checked>
              <label for="jk_l">
                <i class="fas fa-mars"></i>
                <span data-id="Laki-laki" data-en="Male" data-ja="男性"></span>
              </label>
              <input type="radio" id="jk_p" name="jk" value="Perempuan">
              <label for="jk_p">
                <i class="fas fa-venus"></i>
                <span data-id="Perempuan" data-en="Female" data-ja="女性"></span>
              </label>
            </div>
          </div>
        </div>

        <!-- Section: Informasi Kehadiran -->
        <h3 class="section-title" 
            data-id="Informasi Kehadiran"
            data-en="Attendance Information"
            data-ja="参加情報"></h3>

        <!-- Additional Adults -->
        <div class="field" style="margin-bottom: 1.5rem;">
          <label data-id="Dewasa Tambahan" data-en="Additional Adults" data-ja="追加の大人"></label>
          <div class="input-wrapper">
            <i class="fas fa-user-plus"></i>
            <input type="number" id="dewasa_tambahan" name="dewasa_tambahan" min="0" max="10" value="0"
                   data-id-ph="Jumlah dewasa selain Anda"
                   data-en-ph="Number of adults besides you"
                   data-ja-ph="ご本人以外の大人の人数">
          </div>
          <div class="hint" data-id="Usia 13 tahun ke atas" data-en="Age 13 and above" data-ja="13歳以上"></div>
        </div>

        <!-- Children -->
        <div class="field">
          <label data-id="Datang dengan Anak?" data-en="Coming with Children?" data-ja="お子様と一緒ですか？"></label>
          <div class="toggle-group">
            <input type="radio" id="anak_tidak" name="dengan_anak" value="Tidak" checked>
            <label for="anak_tidak">
              <i class="fas fa-times"></i>
              <span data-id="Tidak" data-en="No" data-ja="いいえ"></span>
            </label>
            <input type="radio" id="anak_ya" name="dengan_anak" value="Ya">
            <label for="anak_ya">
              <i class="fas fa-child"></i>
              <span data-id="Ya" data-en="Yes" data-ja="はい"></span>
            </label>
          </div>
          <div class="hint" data-id="Anak usia 0-12 tahun" data-en="Children age 0-12 years" data-ja="0〜12歳のお子様"></div>
        </div>

        <!-- Number of Children -->
        <div class="children-field-wrapper" id="childrenFieldWrapper">
          <div class="field">
            <label data-id="Jumlah Anak" data-en="Number of Children" data-ja="お子様の人数"></label>
            <div class="input-wrapper">
              <i class="fas fa-baby"></i>
              <input type="number" id="jumlah_anak" name="jumlah_anak" min="1" max="10" value="1">
            </div>
            <div class="hint" data-id="Usia maksimal 12 tahun" data-en="Maximum age: 12 years" data-ja="最大12歳まで"></div>
          </div>
        </div>

        <!-- Total Summary -->
        <div class="total-summary">
          <div class="total-label">
            <i class="fas fa-users"></i>
            <span data-id="Total yang akan hadir" data-en="Total attendees" data-ja="総参加者数"></span>
          </div>
          <div class="total-number" id="totalAttendees">1</div>
          <div class="hint" id="totalDetail" style="color: #475569;"></div>
        </div>

        <!-- Section: Persetujuan -->
        <h3 class="section-title" 
            data-id="Persetujuan"
            data-en="Consent"
            data-ja="同意"></h3>

        <!-- Consent -->
        <div class="consent">
          <input type="checkbox" id="consentCheckbox" required>
          <span data-id="<strong>Data jamaah</strong> digunakan semata-mata untuk keperluan pendataan dan kelancaran pelaksanaan acara buka puasa bersama. Kami menjamin kerahasiaan data Anda."
                data-en="<strong>Congregation data</strong> is used solely for registration purposes and the smooth implementation of the iftar gathering. We guarantee the confidentiality of your data."
                data-ja="<strong>礼拝者のデータ</strong>は、登録目的と集団イフタールの円滑な実施のためにのみ使用されます。お客様のデータの機密性を保証します。"></span>
        </div>

        <!-- Islamic Divider inside card -->
        <div class="islamic-divider" style="margin: 2rem 0 1.5rem;">
          <span style="font-size: 1rem;">✿ ✿ ✿</span>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="submit-btn" id="submitBtn">
          <span data-id="Daftar Sekarang" data-en="Register Now" data-ja="今すぐ登録"></span>
        </button>
      </form>
    </div>

    <!-- Footer with prayer message -->
    <footer>
      <div class="prayer-message"
           data-id="Semoga Allah menerima amal ibadah kita di bulan Ramadan yang mulia ini"
           data-en="May Allah accept our worship in this blessed month of Ramadan"
           data-ja="アッラーがこの尊いラマダン月における私たちの礼拝をお受け入れくださいますように"></div>
      
      <div data-id="© 2026 — Yayasan Ibadurrahman Islamic Center"
           data-en="© 2026 — Ibadurrahman Islamic Center Foundation"
           data-ja="© 2026 — イバドゥッラフマン・イスラムセンター財団"></div>
      
      <div class="contact" style="margin-top: 0.75rem;">
        <span data-id="Untuk informasi lebih lanjut:"
              data-en="For more information:"
              data-ja="詳細については："></span>
        <a href="mailto:info@ibadurrahman.org">info@ibadurrahman.org</a>
      </div>
    </footer>
  </div>
</main>

<script>
// ============================================
// KONFIGURASI SISTEM
// ============================================

// GANTI dengan URL Apps Script deployment Anda
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwgEEpMk2LyBCdtfJMoEnj_BSYrVvaY6DQxbg1Y7O0frE-S1zpPJT9xIiz5k0dWdipb/exec";

// Deteksi bahasa
const userLang = navigator.language || navigator.userLanguage;
let lang = 'id';
if (userLang.startsWith('ja')) { 
  lang = 'ja'; 
} else if (userLang.startsWith('en')) { 
  lang = 'en'; 
}

// Application State
let isOTPVerified = false;
let otpAttempts = 0;
const MAX_OTP_ATTEMPTS = 5;

// Messages for multilingual
const messages = {
  fillNameEmail: { 
    id: 'Mohon isi nama dan email terlebih dahulu', 
    en: 'Please fill in name and email first', 
    ja: '先に名前とメールアドレスを入力してください' 
  },
  invalidEmail: { 
    id: 'Format email tidak valid', 
    en: 'Invalid email format', 
    ja: 'メールアドレスの形式が無効です' 
  },
  otpSent: { 
    id: 'Kode OTP telah dikirim ke email Anda', 
    en: 'OTP code has been sent to your email', 
    ja: 'OTPコードをメールに送信しました' 
  },
  otpVerified: { 
    id: 'Kode OTP berhasil diverifikasi', 
    en: 'OTP code successfully verified', 
    ja: 'OTPコードが確認されました' 
  },
  invalidOtp: { 
    id: 'Kode OTP tidak valid', 
    en: 'Invalid OTP code', 
    ja: '無効なOTPコードです' 
  },
  verifyOtpFirst: { 
    id: 'Mohon verifikasi kode OTP terlebih dahulu', 
    en: 'Please verify the OTP code first', 
    ja: '先にOTPコードを確認してください' 
  },
  processing: { 
    id: 'Memproses...', 
    en: 'Processing...', 
    ja: '処理中...' 
  },
  sendingOtp: { 
    id: 'Mengirim OTP...', 
    en: 'Sending OTP...', 
    ja: 'OTP送信中...' 
  },
  success: { 
    id: 'Pendaftaran berhasil! Anda akan menerima email konfirmasi.', 
    en: 'Registration successful! You will receive a confirmation email.', 
    ja: '登録が完了しました！確認メールが送信されます。' 
  },
  networkError: { 
    id: 'Terjadi kesalahan jaringan. Silakan coba lagi.', 
    en: 'Network error. Please try again.', 
    ja: '通信エラーが発生しました。もう一度お試しください。' 
  },
  selectNationality: {
    id: 'Mohon pilih kebangsaan',
    en: 'Please select nationality',
    ja: '国籍を選択してください'
  },
  fillOtherNationality: {
    id: 'Mohon isi kebangsaan Anda',
    en: 'Please enter your nationality',
    ja: '国籍を入力してください'
  },
  consentRequired: {
    id: 'Harap setujui persetujuan data',
    en: 'Please agree to the data consent',
    ja: 'データ同意に同意してください'
  },
  tooManyAttempts: {
    id: 'Terlalu banyak percobaan OTP. Silakan refresh halaman.',
    en: 'Too many OTP attempts. Please refresh the page.',
    ja: 'OTP試行回数が多すぎます。ページを更新してください。'
  },
  emailConfirmed: {
    id: 'Email sudah terkonfirmasi',
    en: 'Email already confirmed',
    ja: 'メールは既に確認済みです'
  }
};

// DOM Elements
const registrationForm = document.getElementById('registrationForm');
const namaLengkapInput = document.getElementById('nama_lengkap');
const emailInput = document.getElementById('email');
const sendOtpBtn = document.getElementById('sendOtpBtn');
const otpField = document.getElementById('otpField');
const otpInput = document.getElementById('otp_input');
const otpHint = document.getElementById('otpHint');
const noHpInput = document.getElementById('no_hp');
const kebangsaanSelect = document.getElementById('kebangsaan');
const otherNationalityWrapper = document.getElementById('otherNationalityWrapper');
const kebangsaanLainnyaInput = document.getElementById('kebangsaan_lainnya');
const dewasaTambahanInput = document.getElementById('dewasa_tambahan');
const denganAnakRadio = document.querySelectorAll('input[name="dengan_anak"]');
const childrenFieldWrapper = document.getElementById('childrenFieldWrapper');
const jumlahAnakInput = document.getElementById('jumlah_anak');
const totalAttendeesSpan = document.getElementById('totalAttendees');
const totalDetailSpan = document.getElementById('totalDetail');
const consentCheckbox = document.getElementById('consentCheckbox');
const submitBtn = document.getElementById('submitBtn');
const duplicateAlert = document.getElementById('duplicateAlert');
const infoMessage = document.getElementById('infoMessage');

// ============================================
// FUNGSI UTILITAS
// ============================================

// Initialize multilingual text
function initMultilingual() {
  document.querySelectorAll('[data-id]').forEach(element => {
    const text = element.getAttribute(`data-${lang}`) || element.getAttribute('data-id');
    if (text && element.tagName !== 'INPUT' && element.tagName !== 'TEXTAREA' && element.tagName !== 'SELECT' && element.tagName !== 'OPTION') {
      element.innerHTML = text;
    }
  });
  
  document.querySelectorAll('[data-id-ph]').forEach(element => {
    const ph = element.getAttribute(`data-${lang}-ph`) || element.getAttribute('data-id-ph');
    if (ph) element.placeholder = ph;
  });
  
  // Update select options
  document.querySelectorAll('option').forEach(option => {
    const translatedText = option.getAttribute(`data-${lang}`) || option.getAttribute('data-id');
    if (translatedText && option.textContent !== '') {
      option.textContent = translatedText;
    }
  });
}

// Calculate total attendees
function calculateTotal() {
  const registrant = 1;
  const additionalAdults = parseInt(dewasaTambahanInput.value) || 0;
  let children = 0;
  
  const denganAnak = document.querySelector('input[name="dengan_anak"]:checked');
  if (denganAnak && denganAnak.value === 'Ya') {
    children = parseInt(jumlahAnakInput.value) || 0;
  }
  
  const total = registrant + additionalAdults + children;
  totalAttendeesSpan.textContent = total;

  if (lang === 'id') {
    totalDetailSpan.textContent = `${registrant} pendaftar, ${additionalAdults} dewasa, ${children} anak`;
  } else if (lang === 'en') {
    totalDetailSpan.textContent = `${registrant} registrant, ${additionalAdults} adults, ${children} children`;
  } else {
    totalDetailSpan.textContent = `登録者${registrant}名、大人${additionalAdults}名、子供${children}名`;
  }
  
  return total;
}

// ============================================
// FUNGSI OTP - PERBAIKAN UTAMA (VERIFIKASI YANG LEBIH BAIK)
// ============================================

// Send OTP
async function sendOTP() {
  const email = emailInput.value.trim();
  const nama = namaLengkapInput.value.trim();
  
  if (!email || !nama) { 
    alert(messages.fillNameEmail[lang]); 
    return; 
  }
  
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    alert(messages.invalidEmail[lang]);
    return;
  }

  sendOtpBtn.disabled = true;
  const originalBtnText = sendOtpBtn.innerHTML;
  sendOtpBtn.innerHTML = `<span class="loading-spinner"></span> ${messages.sendingOtp[lang]}`;

  try {
    const response = await fetch(`${SCRIPT_URL}?action=send_otp&email=${encodeURIComponent(email.toLowerCase())}&nama=${encodeURIComponent(nama)}&lang=${lang}`);
    const result = await response.json();
    
    if (result.status === 'sent') {
      otpField.classList.add('active');
      otpHint.textContent = messages.otpSent[lang];
      otpHint.style.color = '#10a37f';
      
      setTimeout(() => {
        otpInput.focus();
      }, 100);
      
      otpAttempts = 0;
    } else {
      alert(result.error || messages.networkError[lang]);
    }
  } catch (e) { 
    alert(messages.networkError[lang]); 
  } finally { 
    sendOtpBtn.disabled = false; 
    sendOtpBtn.innerHTML = originalBtnText;
    initMultilingual();
  }
}

// Verify OTP with improved error handling and cache prevention
async function verifyOTP() {
  const otpVal = otpInput.value.trim();
  // Hanya proses jika sudah 6 digit
  if (otpVal.length !== 6) return;

  if (otpAttempts >= MAX_OTP_ATTEMPTS) {
    alert(messages.tooManyAttempts[lang]);
    otpInput.disabled = true;
    return;
  }

  try {
    // Tambahkan parameter unik (timestamp) agar browser tidak mengambil data dari cache (penting!)
    const response = await fetch(`${SCRIPT_URL}?action=verify_otp&email=${encodeURIComponent(emailInput.value.toLowerCase())}&otp=${otpVal}&t=${new Date().getTime()}`);
    
    // Pastikan responsnya adalah JSON
    const result = await response.json();
    
    // Cek berbagai kemungkinan format respons dari server
    if (result.status === 'verified' || result.verified === true) {
      isOTPVerified = true;
      otpInput.disabled = true;
      otpInput.style.borderColor = '#10a37f';
      otpInput.style.backgroundColor = '#f0fdf4';
      otpHint.textContent = messages.otpVerified[lang];
      otpHint.style.color = '#10a37f';
      otpAttempts = 0;
    } else {
      otpAttempts++;
      isOTPVerified = false;
      otpInput.style.borderColor = '#dc2626';
      otpInput.style.backgroundColor = '#fef2f2';
      otpHint.textContent = messages.invalidOtp[lang] + ` (${otpAttempts}/${MAX_OTP_ATTEMPTS})`;
      otpHint.style.color = '#dc2626';
    }
  } catch (e) { 
    console.error('Terjadi kesalahan saat verifikasi:', e);
    alert("Gagal terhubung ke server. Pastikan koneksi internet stabil.");
  }
}

// Reset OTP state when email changes
function resetOTPState() {
  isOTPVerified = false;
  otpInput.value = '';
  otpInput.disabled = false;
  otpInput.style.borderColor = '';
  otpInput.style.backgroundColor = '';
  otpField.classList.remove('active');
  
  const defaultHint = otpHint.getAttribute(`data-${lang}`) || otpHint.getAttribute('data-id');
  otpHint.textContent = defaultHint;
  otpHint.style.color = '';
}

// ============================================
// FUNGSI CHECK DUPLICATE
// ============================================

let duplicateCheckTimeout;
async function checkDuplicate() {
  // Only check duplicates after OTP is verified
  if (!isOTPVerified) return;
  
  clearTimeout(duplicateCheckTimeout);
  
  duplicateCheckTimeout = setTimeout(async () => {
    const email = emailInput.value.trim().toLowerCase();
    const phone = noHpInput.value.trim();
    
    if (email && phone && phone.length >= 10) {
      try {
        const response = await fetch(`${SCRIPT_URL}?action=check_duplicate&email=${encodeURIComponent(email)}&no_hp=${encodeURIComponent(phone)}`);
        const result = await response.json();
        
        if (result.isDuplicate) {
          duplicateAlert.classList.add('active');
          submitBtn.disabled = true;
        } else {
          duplicateAlert.classList.remove('active');
          submitBtn.disabled = false;
        }
      } catch (error) {
        console.error('Duplicate check error:', error);
      }
    }
  }, 500);
}

// ============================================
// EVENT LISTENERS
// ============================================

document.addEventListener('DOMContentLoaded', () => {
  initMultilingual();
  calculateTotal();
  
  // Show info message about email confirmation
  infoMessage.classList.add('active');

  // Add email validation for OTP button
  emailInput.addEventListener('input', () => {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    sendOtpBtn.disabled = !emailRegex.test(emailInput.value.trim());
    
    // Reset OTP state when email changes
    resetOTPState();
  });
  
  sendOtpBtn.addEventListener('click', sendOTP);
  
  // Verify OTP on input (with debounce)
  let otpVerifyTimeout;
  otpInput.addEventListener('input', () => {
    clearTimeout(otpVerifyTimeout);
    otpVerifyTimeout = setTimeout(() => {
      verifyOTP();
    }, 300);
  });
  
  kebangsaanSelect.addEventListener('change', (e) => {
    otherNationalityWrapper.classList.toggle('active', e.target.value === 'Lainnya');
    kebangsaanLainnyaInput.required = e.target.value === 'Lainnya';
    
    if (e.target.value === 'Lainnya') {
      setTimeout(() => kebangsaanLainnyaInput.focus(), 100);
    }
  });

  denganAnakRadio.forEach(r => r.addEventListener('change', () => {
    const denganAnak = document.querySelector('input[name="dengan_anak"]:checked');
    childrenFieldWrapper.classList.toggle('active', denganAnak.value === 'Ya');
    jumlahAnakInput.required = denganAnak.value === 'Ya';
    calculateTotal();
  }));

  dewasaTambahanInput.addEventListener('input', calculateTotal);
  jumlahAnakInput.addEventListener('input', calculateTotal);
  
  // Duplicate check (only triggers on input when OTP is verified)
  emailInput.addEventListener('input', checkDuplicate);
  noHpInput.addEventListener('input', checkDuplicate);

  // Form submission
  registrationForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    if (!isOTPVerified) { 
      alert(messages.verifyOtpFirst[lang]); 
      otpInput.focus();
      return; 
    }
    
    // Validate nationality
    const selectedNationality = kebangsaanSelect.value;
    if (!selectedNationality) {
      alert(messages.selectNationality[lang]);
      kebangsaanSelect.focus();
      return;
    }
    
    // Validate other nationality
    if (selectedNationality === 'Lainnya') {
      const otherNationality = kebangsaanLainnyaInput.value.trim();
      if (!otherNationality) {
        alert(messages.fillOtherNationality[lang]);
        kebangsaanLainnyaInput.focus();
        return;
      }
    }
    
    // Check consent
    if (!consentCheckbox.checked) {
      alert(messages.consentRequired[lang]);
      consentCheckbox.focus();
      return;
    }

    submitBtn.disabled = true;
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = `<span class="loading-spinner"></span> ${messages.processing[lang]}`;

    // Prepare form data
    const formData = new FormData(registrationForm);
    const params = new URLSearchParams();
    
    // Process all form fields
    for (const [key, value] of formData) {
      let processedValue = value.toString().trim();
      
      // Special handling for nationality field
      if (key === 'kebangsaan' && value === 'Lainnya') {
        processedValue = kebangsaanLainnyaInput.value.trim();
      }
      
      // Skip kebangsaan_lainnya field as it's already handled
      if (key === 'kebangsaan_lainnya') continue;
      
      // Normalize email to lowercase
      if (key === 'email') {
        processedValue = processedValue.toLowerCase();
      }
      
      params.append(key, processedValue);
    }
    
    // Add total_kehadiran parameter
    params.append('total_kehadiran', calculateTotal().toString());
    
    // Add action and language
    params.append('action', 'register');
    params.append('lang_used', lang);

    try {
      // Use POST with proper headers
      const response = await fetch(SCRIPT_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: params
      });
      
      const result = await response.json();
      
      if (result.success) {
        // Show success message and redirect
        alert(messages.success[lang]);
        if (result.redirect_url) {
          window.location.href = result.redirect_url;
        }
      } else {
        alert(result.error || messages.networkError[lang]);
      }
      
    } catch (error) {
      console.error('Submission error:', error);
      alert(messages.networkError[lang]);
    } finally {
      submitBtn.disabled = false;
      submitBtn.innerHTML = originalText;
      initMultilingual();
    }
  });
});
</script>
</body>
</html>
[file content end]
