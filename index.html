<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Registrasi Buka Puasa Bersama 1447 H</title>

<!-- Open Graph Tags -->
<meta property="og:title" content="Registrasi Buka Puasa Bersama 1447 H">
<meta property="og:description" content="Daftar untuk menghadiri buka puasa bersama di Masjid Central Okayama">
<meta property="og:image" content="https://username.github.io/repo/iftar-og.jpg">
<meta property="og:url" content="https://username.github.io/repo/">

<!-- Fonts -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&family=Open+Sans:wght@400;500;600&display=swap" rel="stylesheet">

<style>
/* ============================================
   RESET & BASE STYLES (OPTIMIZED)
   ============================================ */
:root {
  --accent-green: #10a37f;
  --accent-gold: #d4af37;
  --accent-teal: #0f766e;
  --accent-dark: #1e293b;
  --accent-light: #f8fafc;
  --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  scroll-behavior: smooth;
}

body {
  font-family: 'Poppins', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  background: linear-gradient(135deg, #f7f7f8 0%, #f0f9ff 100%);
  color: var(--accent-dark);
  line-height: 1.6;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* ============================================
   LAYOUT & CONTAINER
   ============================================ */
main {
  padding: 2rem 1rem;
  position: relative;
  overflow: hidden;
}

.container {
  max-width: 520px;
  margin: 0 auto;
  position: relative;
  z-index: 1;
}

/* ============================================
   DECORATIVE BACKGROUND ELEMENTS
   ============================================ */
.ornament-top {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 120px;
  background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-teal) 100%);
  clip-path: polygon(0 0, 100% 0, 100% 70%, 0 100%);
  z-index: 0;
  opacity: 0.9;
}

.ornament-bottom {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 80px;
  background: linear-gradient(135deg, var(--accent-teal) 0%, var(--accent-green) 100%);
  clip-path: polygon(0 30%, 100% 0, 100% 100%, 0 100%);
  z-index: 0;
  opacity: 0.9;
}

.islamic-pattern {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-image: 
    radial-gradient(circle at 10% 10%, rgba(16, 163, 127, 0.05) 1px, transparent 1px),
    radial-gradient(circle at 90% 90%, rgba(212, 175, 55, 0.05) 1px, transparent 1px);
  background-size: 30px 30px;
  z-index: 0;
}

/* ============================================
   HEADER STYLES (REVISED - TULISAN ARAB)
   ============================================ */
.header {
  text-align: center;
  margin-bottom: 2.5rem;
  padding: 0 0.5rem;
  position: relative;
}

/* Arabic Greeting - MARHABAN YA RAMADAN */
.arabic-greeting {
  margin: 0 auto 2rem;
  padding: 1.5rem 0;
  position: relative;
  overflow: hidden;
}

.arabic-text {
  font-family: 'Amiri', serif;
  font-size: 3.2rem;
  font-weight: 700;
  color: transparent;
  background: linear-gradient(
    135deg,
    #d4af37 0%,
    #f0b40a 30%,
    #ffd700 50%,
    #f0b40a 70%,
    #d4af37 100%
  );
  background-clip: text;
  -webkit-background-clip: text;
  text-align: center;
  line-height: 1.2;
  letter-spacing: 2px;
  position: relative;
  animation: arabicGlow 4s ease-in-out infinite alternate;
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
}

.arabic-text::before {
  content: attr(data-text);
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  color: rgba(212, 175, 55, 0.15);
  z-index: -1;
  animation: arabicShadow 6s ease-in-out infinite alternate;
}

@keyframes arabicGlow {
  0%, 100% {
    opacity: 1;
    background-position: 0% 50%;
    filter: drop-shadow(0 2px 8px rgba(212, 175, 55, 0.3));
  }
  50% {
    opacity: 0.95;
    background-position: 100% 50%;
    filter: drop-shadow(0 4px 16px rgba(212, 175, 55, 0.5));
  }
}

@keyframes arabicShadow {
  0%, 100% {
    transform: translate(0, 0) scale(1);
  }
  25% {
    transform: translate(2px, 1px) scale(1.01);
  }
  75% {
    transform: translate(-1px, -1px) scale(0.99);
  }
}

.header h1 {
  margin: 0 0 1rem 0;
  font-size: 1.9rem;
  color: var(--accent-dark);
  font-weight: 700;
  letter-spacing: -0.01em;
  line-height: 1.3;
  position: relative;
  display: inline-block;
}

.header h1::after {
  content: '';
  position: absolute;
  bottom: -10px;
  left: 50%;
  transform: translateX(-50%);
  width: 100px;
  height: 3px;
  background: linear-gradient(90deg, transparent, var(--accent-gold), transparent);
  border-radius: 2px;
}

.header .center-name {
  color: var(--accent-teal);
  font-weight: 600;
  font-size: 1.1rem;
  margin-bottom: 1rem;
  font-family: 'Poppins', sans-serif;
}

.header .subtitle {
  color: #64748b;
  font-size: 0.95rem;
  font-weight: 400;
  line-height: 1.6;
  margin-bottom: 1rem;
  max-width: 480px;
  margin-left: auto;
  margin-right: auto;
}

.event-purpose {
  background: linear-gradient(135deg, rgba(16, 163, 127, 0.08) 0%, rgba(15, 118, 110, 0.08) 100%);
  border-radius: 12px;
  padding: 1rem 1.25rem;
  margin: 1.5rem auto 0;
  max-width: 480px;
  border-left: 4px solid var(--accent-gold);
  font-size: 0.9rem;
  color: var(--accent-teal);
  line-height: 1.6;
  font-style: italic;
  text-align: center;
  box-shadow: 0 2px 8px rgba(16, 163, 127, 0.1);
  backdrop-filter: blur(10px);
}

.islamic-divider {
  text-align: center;
  margin: 1.5rem 0;
  position: relative;
}

.islamic-divider::before,
.islamic-divider::after {
  content: '';
  position: absolute;
  top: 50%;
  width: 30%;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--accent-gold), transparent);
}

.islamic-divider::before {
  left: 0;
}

.islamic-divider::after {
  right: 0;
}

.islamic-divider span {
  color: var(--accent-gold);
  font-size: 1.2rem;
  letter-spacing: 8px;
  display: inline-block;
  padding: 0 10px;
  background: var(--accent-light);
}

/* ============================================
   CARD STYLES
   ============================================ */
.card {
  background: #ffffff;
  padding: 2.5rem;
  border-radius: 16px;
  border: 1px solid #e2e8f0;
  box-shadow: 0 8px 32px rgba(16, 163, 127, 0.08);
  margin-bottom: 2.5rem;
  transition: all var(--transition);
  position: relative;
  overflow: hidden;
  backdrop-filter: blur(10px);
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 4px;
  height: 100%;
  background: linear-gradient(180deg, var(--accent-green), var(--accent-gold));
}

.card:hover {
  box-shadow: 0 12px 40px rgba(16, 163, 127, 0.12);
  transform: translateY(-2px);
}

/* ============================================
   FORM STYLES
   ============================================ */
.section-title {
  font-size: 0.95rem;
  color: var(--accent-teal);
  border-left: 3px solid var(--accent-gold);
  padding-left: 1rem;
  margin: 2.5rem 0 1.5rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-family: 'Poppins', sans-serif;
  position: relative;
  padding-top: 0.25rem;
  padding-bottom: 0.25rem;
}

.section-title:first-child {
  margin-top: 0;
}

.section-title::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: linear-gradient(180deg, var(--accent-green), var(--accent-gold));
  border-radius: 2px;
}

.field {
  margin-bottom: 1.75rem;
  position: relative;
}

label {
  display: block;
  margin-bottom: 0.75rem;
  font-weight: 600;
  font-size: 0.9rem;
  color: var(--accent-dark);
  letter-spacing: -0.01em;
  font-family: 'Poppins', sans-serif;
}

.input-wrapper {
  position: relative;
  transition: transform var(--transition);
}

.input-wrapper:hover {
  transform: translateY(-1px);
}

.input-wrapper i {
  position: absolute;
  left: 1rem;
  top: 50%;
  transform: translateY(-50%);
  color: #94a3b8;
  font-size: 1rem;
  transition: color var(--transition);
  z-index: 1;
}

input:focus + i,
select:focus + i {
  color: var(--accent-green);
}

input, select {
  width: 100%;
  padding: 1rem 1rem 1rem 3rem;
  border-radius: 10px;
  border: 1.5px solid #e2e8f0;
  font-size: 0.95rem;
  font-family: 'Inter', sans-serif;
  background: #ffffff;
  transition: all var(--transition);
  color: var(--accent-dark);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
  position: relative;
}

input:focus, select:focus {
  outline: none;
  border-color: var(--accent-green);
  box-shadow: 0 0 0 3px rgba(16, 163, 127, 0.15);
  background: #ffffff;
}

/* Select Styles */
select {
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2394a3b8'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 1rem center;
  background-size: 1.25rem;
  padding-right: 3rem;
  cursor: pointer;
}

/* Radio & Toggle Button Styles */
.radio-group, .toggle-group {
  display: flex;
  gap: 0.75rem;
}

.radio-group input, .toggle-group input {
  display: none;
}

.radio-group label, .toggle-group label {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 1rem 1.25rem;
  border-radius: 10px;
  border: 1.5px solid #e2e8f0;
  background: #f8fafc;
  font-size: 0.9rem;
  font-weight: 500;
  color: #475569;
  cursor: pointer;
  transition: all var(--transition);
  margin-bottom: 0;
}

.radio-group label i, .toggle-group label i {
  position: static;
  transform: none;
  font-size: 1rem;
}

.radio-group input:checked + label,
.toggle-group input:checked + label {
  background: rgba(16, 163, 127, 0.1);
  border-color: var(--accent-green);
  color: var(--accent-teal);
  font-weight: 600;
  box-shadow: 0 4px 8px rgba(16, 163, 127, 0.1);
}

/* Hint Text */
.hint {
  font-size: 0.8rem;
  color: #64748b;
  margin-top: 0.5rem;
  line-height: 1.5;
  padding-left: 0.25rem;
}

/* Row Layout */
.row {
  display: flex;
  gap: 1rem;
}

.row .field {
  flex: 1;
}

/* Other Nationality Field */
.other-nationality-wrapper {
  display: none;
  margin-top: 1rem;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.other-nationality-wrapper.active {
  display: block;
}

/* Children Field */
.children-field-wrapper {
  display: none;
  margin-top: 1rem;
  animation: fadeIn 0.3s ease;
}

.children-field-wrapper.active {
  display: block;
}

/* Reduce Motion */
@media (prefers-reduced-motion: reduce) {
  * {
    animation: none !important;
    transition: none !important;
  }
}

/* ============================================
   TOTAL SUMMARY
   ============================================ */
.total-summary {
  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  border: 1.5px solid #e2e8f0;
  border-radius: 12px;
  padding: 1.75rem;
  margin-top: 2rem;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.total-summary::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--accent-green), var(--accent-gold), var(--accent-teal));
}

.total-number {
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--accent-teal);
  margin: 0.5rem 0;
  font-family: 'Poppins', sans-serif;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.total-label {
  font-size: 0.9rem;
  color: var(--accent-dark);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  font-weight: 600;
  margin-bottom: 0.75rem;
}

.total-label i {
  color: var(--accent-green);
  font-size: 1.2rem;
}

/* ============================================
   CONSENT CHECKBOX
   ============================================ */
.consent {
  display: flex;
  align-items: flex-start;
  gap: 1rem;
  padding: 1.5rem;
  background: linear-gradient(135deg, rgba(16, 163, 127, 0.05) 0%, rgba(15, 118, 110, 0.05) 100%);
  border: 1.5px solid #e2e8f0;
  border-radius: 12px;
  margin: 2rem 0;
  transition: all var(--transition);
}

.consent:hover {
  border-color: var(--accent-green);
  background: linear-gradient(135deg, rgba(16, 163, 127, 0.08) 0%, rgba(15, 118, 110, 0.08) 100%);
}

.consent input {
  width: 1.5rem;
  height: 1.5rem;
  margin-top: 0.125rem;
  flex-shrink: 0;
  border-radius: 6px;
  accent-color: var(--accent-green);
  cursor: pointer;
}

.consent label {
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
  margin-bottom: 0;
  cursor: pointer;
  font-weight: 500;
  line-height: 1.6;
}

.consent-label-text {
  font-size: 0.9rem;
  color: var(--accent-dark);
  line-height: 1.6;
  font-weight: 500;
}

.consent-label-text strong {
  color: var(--accent-teal);
  font-weight: 600;
}

/* ============================================
   BUTTON STYLES
   ============================================ */
.submit-btn {
  width: 100%;
  padding: 1.25rem;
  background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-teal) 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--transition);
  font-family: 'Poppins', sans-serif;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  box-shadow: 0 6px 20px rgba(16, 163, 127, 0.2);
  position: relative;
  overflow: hidden;
}

.submit-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s ease;
}

.submit-btn:hover {
  background: linear-gradient(135deg, var(--accent-teal) 0%, var(--accent-green) 100%);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(16, 163, 127, 0.3);
}

.submit-btn:hover::before {
  left: 100%;
}

.submit-btn:disabled {
  background: #cbd5e1;
  transform: none;
  box-shadow: none;
  cursor: not-allowed;
}

.submit-btn:disabled::before {
  display: none;
}

/* ============================================
   ALERT MESSAGES
   ============================================ */
.alert-message {
  display: none;
  background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
  color: #dc2626;
  padding: 1.25rem;
  border-radius: 12px;
  border: 1.5px solid #fecaca;
  margin-bottom: 1.75rem;
  text-align: center;
  font-size: 0.9rem;
  font-weight: 500;
  animation: slideDown 0.3s ease;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.alert-message.active {
  display: block;
}

.success-message {
  display: none;
  background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
  color: #166534;
  padding: 1.25rem;
  border-radius: 12px;
  border: 1.5px solid #bbf7d0;
  margin-bottom: 1.75rem;
  text-align: center;
  font-size: 0.9rem;
  font-weight: 500;
  animation: slideDown 0.3s ease;
}

.success-message.active {
  display: block;
}

.info-message {
  display: none;
  background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
  color: #0369a1;
  padding: 1.25rem;
  border-radius: 12px;
  border: 1.5px solid #bae6fd;
  margin-bottom: 1.75rem;
  text-align: center;
  font-size: 0.9rem;
  font-weight: 500;
  animation: slideDown 0.3s ease;
}

.info-message.active {
  display: block;
}

/* Duplicate Alert */
.duplicate-alert {
  display: none;
  background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
  color: #d97706;
  padding: 1.25rem;
  border-radius: 12px;
  border: 1.5px solid #fde68a;
  margin-bottom: 1.75rem;
  text-align: center;
  font-size: 0.9rem;
  font-weight: 500;
  animation: slideDown 0.3s ease;
}

.duplicate-alert.active {
  display: block;
}

/* ============================================
   FOOTER
   ============================================ */
footer {
  text-align: center;
  color: #64748b;
  font-size: 0.85rem;
  padding: 1.5rem 0;
  border-top: 1px solid #e2e8f0;
  margin-top: 3rem;
  position: relative;
}

.prayer-message {
  background: linear-gradient(135deg, rgba(212, 175, 55, 0.08) 0%, rgba(16, 163, 127, 0.08) 100%);
  border-radius: 12px;
  padding: 1rem 1.5rem;
  margin: 1rem auto 1.5rem;
  max-width: 500px;
  color: var(--accent-teal);
  font-style: italic;
  line-height: 1.6;
  font-size: 0.9rem;
  border: 1px solid rgba(212, 175, 55, 0.2);
}

footer .center-name {
  font-weight: 600;
  color: var(--accent-teal);
  margin-bottom: 0.5rem;
  font-size: 0.9rem;
}

footer .contact {
  margin-top: 0.75rem;
  font-size: 0.8rem;
  color: #94a3b8;
}

footer .contact a {
  color: var(--accent-green);
  text-decoration: none;
  transition: color var(--transition);
}

footer .contact a:hover {
  color: var(--accent-teal);
  text-decoration: underline;
}

/* ============================================
   UTILITY CLASSES
   ============================================ */
.loading-spinner {
  display: inline-block;
  width: 1.2rem;
  height: 1.2rem;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: #fff;
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* ============================================
   COMPONENTS
   ============================================ */
.language-selector {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 100;
  background: white;
  padding: 8px 12px;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.language-selector select {
  padding: 6px 10px;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  font-size: 0.9rem;
  font-family: 'Inter', sans-serif;
  color: var(--accent-dark);
}

.language-selector select:focus {
  outline: none;
  border-color: var(--accent-green);
}

.progress-indicator {
  display: none;
  text-align: center;
  margin-top: 1rem;
}

.progress-indicator.active {
  display: block;
}

/* Validation States */
.input-wrapper.error input,
.input-wrapper.error select {
  border-color: #dc2626;
  background: #fef2f2;
}

.input-wrapper.success input,
.input-wrapper.success select {
  border-color: #10b981;
  background: #f0fdf4;
}

.validation-message {
  font-size: 0.8rem;
  margin-top: 0.5rem;
  padding-left: 0.25rem;
}

.validation-message.error {
  color: #dc2626;
}

.validation-message.success {
  color: #059669;
}

/* ============================================
   RESPONSIVE DESIGN
   ============================================ */
@media (max-width: 640px) {
  main {
    padding: 1.5rem 1rem;
  }
  
  .card {
    padding: 1.75rem;
  }
  
  .row {
    flex-direction: column;
    gap: 1rem;
  }
  
  input, select {
    padding: 0.9rem 1rem 0.9rem 2.75rem;
    font-size: 0.9rem;
  }
  
  .input-wrapper i {
    left: 0.875rem;
    font-size: 0.9rem;
  }
  
  .total-summary {
    padding: 1.5rem;
  }
  
  .total-number {
    font-size: 2.2rem;
  }
  
  .header h1 {
    font-size: 1.7rem;
  }
  
  .arabic-greeting {
    margin-bottom: 1.5rem;
  }
  
  .arabic-text {
    font-size: 2.5rem;
  }
  
  .section-title {
    margin: 2rem 0 1.25rem;
  }
  
  .language-selector {
    top: 15px;
    right: 15px;
    padding: 6px 10px;
  }
}

/* High-contrast mode support */
@media (prefers-contrast: high) {
  :root {
    --accent-green: #0a8;
    --accent-gold: #b90;
    --accent-teal: #066;
    --accent-dark: #000;
    --accent-light: #fff;
  }
}

/* Print styles */
@media print {
  .language-selector,
  .submit-btn,
  .ornament-top,
  .ornament-bottom,
  .islamic-pattern {
    display: none;
  }
  
  body {
    background: white;
    color: black;
  }
  
  .card {
    box-shadow: none;
    border: 1px solid #ddd;
  }
}
</style>
</head>

<body>
<!-- Decorative Background Elements -->
<div class="ornament-top" aria-hidden="true"></div>
<div class="ornament-bottom" aria-hidden="true"></div>
<div class="islamic-pattern" aria-hidden="true"></div>

<!-- Language Selector -->
<div class="language-selector">
  <select id="languageSelector" aria-label="Pilih bahasa">
    <option value="id">ğŸ‡®ğŸ‡© Indonesia</option>
    <option value="en">ğŸ‡¬ğŸ‡§ English</option>
    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
  </select>
</div>

<main>
  <div class="container">
    <!-- Alert Messages -->
    <div class="duplicate-alert" id="duplicateAlert" role="alert" aria-live="assertive">
      <i class="fas fa-exclamation-triangle"></i>
      <span id="duplicateAlertText">Data ini sudah terdaftar</span>
    </div>

    <div class="info-message" id="infoMessage" role="status" aria-live="polite">
      <i class="fas fa-info-circle"></i>
      <span id="infoMessageText">Setelah submit, Anda akan diarahkan ke halaman konfirmasi</span>
    </div>

    <div class="alert-message" id="alertMessage" role="alert" aria-live="assertive">
      <i class="fas fa-exclamation-circle"></i>
      <span id="alertMessageText"></span>
    </div>

    <div class="success-message" id="successMessage" role="status" aria-live="polite">
      <i class="fas fa-check-circle"></i>
      <span id="successMessageText"></span>
    </div>

    <!-- Header -->
    <div class="header">
      <div class="arabic-greeting">
        <div class="arabic-text" data-text="Ù…ÙØ±Ù’Ø­ÙØ¨Ø§Ù‹ ÙŠÙØ§ Ø±ÙÙ…ÙØ¶ÙØ§Ù†">
          Ù…ÙØ±Ù’Ø­ÙØ¨Ø§Ù‹ ÙŠÙØ§ Ø±ÙÙ…ÙØ¶ÙØ§Ù†
        </div>
      </div>
      
      <h1 id="mainTitle">Registrasi Buka Puasa Bersama 1447 H</h1>
      
      <div class="center-name" id="centerName">Masjid Central Okayama</div>
      
      <div class="subtitle" id="subtitleText">
        Silakan lengkapi formulir registrasi di bawah ini dengan data yang valid
      </div>
      
      <div class="event-purpose" id="eventPurpose">
        Formulir ini digunakan untuk pendataan jamaah agar pelaksanaan buka puasa bersama berjalan tertib, nyaman, dan penuh keberkahan
      </div>
    </div>

    <!-- Islamic Divider -->
    <div class="islamic-divider" aria-hidden="true">
      <span>âœ¦ âœ¦ âœ¦</span>
    </div>

    <!-- Registration Form -->
    <div class="card">
      <form id="registrationForm" autocomplete="on" novalidate>
        
        <!-- Section: Data Jamaah -->
        <h3 class="section-title" id="sectionDataJamaah">
          <i class="fas fa-user" aria-hidden="true"></i> Data Jamaah
        </h3>

        <!-- Full Name -->
        <div class="field">
          <label for="nama_lengkap" id="labelNamaLengkap">Nama Lengkap</label>
          <div class="input-wrapper">
            <i class="fas fa-user" aria-hidden="true"></i>
            <input type="text" id="nama_lengkap" name="nama_lengkap" required 
                   placeholder="Nama sesuai identitas" minlength="3" maxlength="100"
                   aria-describedby="namaHint">
          </div>
          <div class="hint" id="namaHint">Wajib diisi sesuai KTP/Identitas</div>
        </div>

        <!-- Email -->
        <div class="field">
          <label for="email" id="labelEmail">Alamat Email</label>
          <div class="input-wrapper">
            <i class="fas fa-envelope" aria-hidden="true"></i>
            <input type="email" id="email" name="email" required 
                   placeholder="contoh@email.com" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                   aria-describedby="emailHint">
          </div>
          <div class="hint" id="hintEmail">Konfirmasi akan dikirim ke email ini</div>
        </div>

        <!-- Phone Number -->
        <div class="field">
          <label for="no_hp" id="labelNoHp">Nomor Telepon</label>
          <div class="input-wrapper">
            <i class="fas fa-phone" aria-hidden="true"></i>
            <input type="tel" id="no_hp" name="no_hp" required 
                   placeholder="081234567890 atau 08012345678" 
                   inputmode="numeric"
                   maxlength="15"
                   aria-describedby="phoneHint">
          </div>
          <div class="hint" id="hintNoHp">Format Jepang (080/090/070) atau Indonesia (08)</div>
        </div>

        <!-- Residence -->
        <div class="field">
          <label for="domisili" id="labelDomisili">Domisili</label>
          <div class="input-wrapper">
            <i class="fas fa-map-marker-alt" aria-hidden="true"></i>
            <input type="text" id="domisili" name="domisili" list="neighborhoods" required 
                   placeholder="Cari nama kelurahan/kecamatan">
            <datalist id="neighborhoods">
              <option value="Okayama-shi, Kita-ku, Kaminakano">
              <option value="Okayama-shi, Kita-ku, Ima">
              <option value="Okayama-shi, Kita-ku, Omoto">
              <option value="Okayama-shi, Kita-ku, Tsushima">
              <option value="Okayama-shi, Kita-ku, Hokan-cho">
              <option value="Okayama-shi, Naka-ku, Nishigawara">
              <option value="Okayama-shi, Minami-ku, Toyonari">
              <option value="Kurashiki-shi, Achi">
              <option value="Kurashiki-shi, Nakasho">
              <option value="Kurashiki-shi, Chaya-machi">
              <option value="Kurashiki-shi, Mizushima">
              <option value="Kurashiki-shi, Kojima">
              <option value="Kurashiki-shi, Tamashima">
              <option value="Tamano-shi, Chikko">
              <option value="Tamano-shi, Uno">
              <option value="Tamano-shi, Hibibi">
              <option value="Tamano-shi, Shibukawa">
              <option value="Soja-shi, Chuo">
              <option value="Soja-shi, Kiyone">
              <option value="Soja-shi, Yamate">
              <option value="Akaiwa-shi, Sanyo">
              <option value="Setouchi-shi, Oku-cho">
            </datalist>
          </div>
        </div>

        <!-- Nationality -->
        <div class="field">
          <label for="kebangsaan" id="labelKebangsaan">Kebangsaan</label>
          <div class="input-wrapper">
            <i class="fas fa-globe" aria-hidden="true"></i>
            <select id="kebangsaan" name="kebangsaan" required>
              <option value="">Pilih kebangsaan</option>
              <option value="Indonesia">Indonesia</option>
              <option value="Jepang">Jepang</option>
              <option value="Lainnya">Lainnya</option>
            </select>
          </div>

          <div class="other-nationality-wrapper" id="otherNationalityWrapper">
            <div class="input-wrapper">
              <i class="fas fa-edit" aria-hidden="true"></i>
              <input type="text" id="kebangsaan_lainnya" name="kebangsaan_lainnya"
                     placeholder="Masukkan kebangsaan Anda">
            </div>
          </div>
        </div>

        <!-- Age & Gender -->
        <div class="row">
          <div class="field">
            <label for="usia" id="labelUsia">Usia</label>
            <div class="input-wrapper">
              <i class="fas fa-birthday-cake" aria-hidden="true"></i>
              <input type="number" id="usia" name="usia" min="1" max="120" required 
                     placeholder="Usia saat ini">
            </div>
          </div>

          <div class="field">
            <label id="labelJenisKelamin">Jenis Kelamin</label>
            <div class="radio-group" role="radiogroup">
              <input type="radio" id="jk_l" name="jk" value="Laki-laki" required checked>
              <label for="jk_l">
                <i class="fas fa-mars" aria-hidden="true"></i>
                <span id="labelLakiLaki">Laki-laki</span>
              </label>
              <input type="radio" id="jk_p" name="jk" value="Perempuan">
              <label for="jk_p">
                <i class="fas fa-venus" aria-hidden="true"></i>
                <span id="labelPerempuan">Perempuan</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Section: Informasi Kehadiran -->
        <h3 class="section-title" id="sectionKehadiran">
          <i class="fas fa-users" aria-hidden="true"></i> Informasi Kehadiran
        </h3>

        <!-- Additional Adults -->
        <div class="field">
          <label for="dewasa_tambahan" id="labelDewasaTambahan">Dewasa Tambahan</label>
          <div class="input-wrapper">
            <i class="fas fa-user-plus" aria-hidden="true"></i>
            <input type="number" id="dewasa_tambahan" name="dewasa_tambahan" min="0" max="5" value="0"
                   placeholder="Jumlah dewasa selain Anda"
                   aria-describedby="dewasaHint">
          </div>
          <div class="hint" id="hintDewasa">Usia 13 tahun ke atas</div>
        </div>

        <!-- Children -->
        <div class="field">
          <label id="labelDatangDenganAnak">Datang dengan Anak?</label>
          <div class="toggle-group" role="radiogroup">
            <input type="radio" id="anak_tidak" name="dengan_anak" value="Tidak" checked>
            <label for="anak_tidak">
              <i class="fas fa-times" aria-hidden="true"></i>
              <span id="labelTidak">Tidak</span>
            </label>
            <input type="radio" id="anak_ya" name="dengan_anak" value="Ya">
            <label for="anak_ya">
              <i class="fas fa-child" aria-hidden="true"></i>
              <span id="labelYa">Ya</span>
            </label>
          </div>
          <div class="hint" id="hintAnak">Anak usia 0-12 tahun</div>
        </div>

        <!-- Number of Children -->
        <div class="children-field-wrapper" id="childrenFieldWrapper">
          <div class="field">
            <label for="jumlah_anak" id="labelJumlahAnak">Jumlah Anak</label>
            <div class="input-wrapper">
              <i class="fas fa-baby" aria-hidden="true"></i>
              <input type="number" id="jumlah_anak" name="jumlah_anak" min="1" max="5" value="1"
                     aria-describedby="usiaAnakHint">
            </div>
            <div class="hint" id="hintUsiaAnak">Usia maksimal 12 tahun</div>
          </div>
        </div>

        <!-- Total Summary -->
        <div class="total-summary">
          <div class="total-label">
            <i class="fas fa-users" aria-hidden="true"></i>
            <span id="totalLabel">Total yang akan hadir</span>
          </div>
          <div class="total-number" id="totalAttendees">1</div>
          <div class="hint" id="totalDetail">1 pendaftar, 0 dewasa, 0 anak</div>
        </div>

        <!-- Section: Persetujuan -->
        <h3 class="section-title" id="sectionPersetujuan">
          <i class="fas fa-file-signature" aria-hidden="true"></i> Persetujuan
        </h3>

        <!-- Consent -->
        <div class="consent">
          <input type="checkbox" id="consentCheckbox" required>
          <label for="consentCheckbox">
            <span class="consent-label-text" id="consentText">
              <strong>Data jamaah</strong> digunakan semata-mata untuk keperluan pendataan dan kelancaran pelaksanaan acara buka puasa bersama. Kami menjamin kerahasiaan data Anda.
            </span>
          </label>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="submit-btn" id="submitBtn" disabled>
          <span id="submitText">Daftar Sekarang</span>
        </button>

        <!-- Progress Indicator -->
        <div class="progress-indicator" id="progressIndicator">
          <div class="loading-spinner" aria-hidden="true"></div>
          <div style="font-size: 0.9rem; color: var(--accent-teal); margin-top: 0.5rem;" id="progressText">
            Mengirim data...
          </div>
        </div>
      </form>
    </div>

    <!-- Footer -->
    <footer>
      <div class="prayer-message" id="prayerMessage">
        <i class="fas fa-star-and-crescent" aria-hidden="true"></i>
        Semoga Allah menerima amal ibadah kita di bulan Ramadan yang mulia ini
      </div>
      
      <div id="footerCopyright">Â© 2026 â€” Masjid Central Okayama</div>
      
      <div class="contact">
        <span id="contactText">Untuk informasi lebih lanjut:</span>
        <a href="mailto:ibadurrahmanislamiccenter@gmail.com">
          ibadurrahmanislamiccenter@gmail.com
        </a>
      </div>
    </footer>
  </div>
</main>

<script>
// ============================================
// KONFIGURASI SISTEM - SATU SUMBER KEBENARAN
// ============================================
const CONFIG = Object.freeze({
  // âš ï¸ URL HARUS SAMA PERSIS dengan di success.html
  API_URL: "https://script.google.com/macros/s/AKfycbwyGSZOqvP0nEvnW59d-nmWiQ8VNTJr3zGShM7wq8uUVgmS21Na6lDGB4k1eC78_PgZ/exec",
  MAX_OTP_ATTEMPTS: 3,
  OTP_TIMEOUT: 60000,
  RETRY_ATTEMPTS: 2,
  ENABLE_OFFLINE: false,
  SUPPORTED_LANGUAGES: ['id', 'en', 'ja']
});

// ============================================
// VARIABEL STATE GLOBAL
// ============================================
let lang = 'id';
let isSubmitting = false;
let duplicateCheckTimeout = null;

// Deteksi bahasa pengguna
const userLang = navigator.language || navigator.userLanguage;
if (userLang.startsWith('ja')) lang = 'ja';
else if (userLang.startsWith('en')) lang = 'en';

// ============================================
// TRANSLATIONS
// ============================================

const translations = {
  id: {
    // Messages
    fillNameEmail: 'Mohon isi nama dan email terlebih dahulu',
    invalidEmail: 'Format email tidak valid',
    invalidPhone: 'Nomor telepon tidak valid. Gunakan format Jepang (080/090/070) atau Indonesia (08)',
    processing: 'Memproses...',
    success: 'Pendaftaran berhasil!',
    networkError: 'Terjadi kesalahan jaringan. Silakan coba lagi.',
    serverError: 'Terjadi kesalahan pada server. Silakan coba lagi.',
    selectNationality: 'Mohon pilih kebangsaan',
    fillOtherNationality: 'Mohon isi kebangsaan Anda',
    consentRequired: 'Harap setujui persetujuan data',
    duplicateData: 'Data ini sudah terdaftar',
    registrationComplete: 'Pendaftaran berhasil! Silakan cek email untuk konfirmasi.',
    submitting: 'Mengirim data...',
    
    // UI Text
    duplicateAlert: 'Data ini sudah terdaftar',
    infoMessage: 'Setelah submit, Anda akan diarahkan ke halaman konfirmasi',
    mainTitle: 'Registrasi Buka Puasa Bersama 1447 H',
    centerName: 'Masjid Central Okayama',
    subtitle: 'Silakan lengkapi formulir registrasi di bawah ini dengan data yang valid',
    eventPurpose: 'Formulir ini digunakan untuk pendataan jamaah agar pelaksanaan buka puasa bersama berjalan tertib, nyaman, dan penuh keberkahan',
    
    // Form labels
    namaLengkap: 'Nama Lengkap',
    namaPlaceholder: 'Nama sesuai identitas',
    email: 'Alamat Email',
    emailPlaceholder: 'contoh@email.com',
    hintEmail: 'Konfirmasi akan dikirim ke email ini',
    noHp: 'Nomor Telepon',
    noHpPlaceholder: '081234567890',
    hintNoHp: 'Gunakan nomor aktif yang dapat dihubungi',
    domisili: 'Domisili',
    domisiliPlaceholder: 'Cari nama kelurahan/kecamatan',
    kebangsaan: 'Kebangsaan',
    kebangsaanLainnya: 'Kebangsaan Lainnya',
    kebangsaanPlaceholder: 'Masukkan kebangsaan Anda',
    selectKebangsaan: 'Pilih kebangsaan',
    indonesia: 'Indonesia',
    jepang: 'Jepang',
    lainnya: 'Lainnya',
    usia: 'Usia',
    usiaPlaceholder: 'Usia saat ini',
    jenisKelamin: 'Jenis Kelamin',
    lakiLaki: 'Laki-laki',
    perempuan: 'Perempuan',
    sectionDataJamaah: 'Data Jamaah',
    sectionKehadiran: 'Informasi Kehadiran',
    dewasaTambahan: 'Dewasa Tambahan',
    dewasaPlaceholder: 'Jumlah dewasa selain Anda',
    hintDewasa: 'Usia 13 tahun ke atas',
    datangDenganAnak: 'Datang dengan Anak?',
    tidak: 'Tidak',
    ya: 'Ya',
    hintAnak: 'Anak usia 0-12 tahun',
    jumlahAnak: 'Jumlah Anak',
    hintUsiaAnak: 'Usia maksimal 12 tahun',
    sectionPersetujuan: 'Persetujuan',
    consentText: '<strong>Data jamaah</strong> digunakan semata-mata untuk keperluan pendataan dan kelancaran pelaksanaan acara buka puasa bersama. Kami menjamin kerahasiaan data Anda.',
    submit: 'Daftar Sekarang',
    
    // Footer
    prayerMessage: 'Semoga Allah menerima amal ibadah kita di bulan Ramadan yang mulia ini',
    footerCopyright: 'Â© 2026 â€” Masjid Central Okayama',
    contactText: 'Untuk informasi lebih lanjut:',
    totalLabel: 'Total yang akan hadir',
    progressText: 'Mengirim data...'
  },
  
  en: {
    // Messages
    fillNameEmail: 'Please fill in name and email first',
    invalidEmail: 'Invalid email format',
    invalidPhone: 'Invalid phone number. Use Japanese format (080/090/070) or Indonesian format (08)',
    processing: 'Processing...',
    success: 'Registration successful!',
    networkError: 'Network error. Please try again.',
    serverError: 'Server error. Please try again.',
    selectNationality: 'Please select nationality',
    fillOtherNationality: 'Please enter your nationality',
    consentRequired: 'Please agree to the data consent',
    duplicateData: 'This data is already registered',
    registrationComplete: 'Registration successful! Please check your email for confirmation.',
    submitting: 'Submitting data...',
    
    // UI Text
    duplicateAlert: 'This data is already registered',
    infoMessage: 'After submission, you will be redirected to the confirmation page',
    mainTitle: 'Ramadan Iftar Registration 1447 AH',
    centerName: 'Okayama Central Mosque',
    subtitle: 'Please complete the registration form below with valid data',
    eventPurpose: 'This form is used to register congregation members so that the iftar gathering runs orderly, comfortably, and full of blessings',
    
    // Form labels
    namaLengkap: 'Full Name',
    namaPlaceholder: 'Name as shown on ID',
    email: 'Email Address',
    emailPlaceholder: 'example@email.com',
    hintEmail: 'Confirmation will be sent to this email',
    noHp: 'Phone Number',
    noHpPlaceholder: '081234567890',
    hintNoHp: 'Use an active contact number',
    domisili: 'Residence',
    domisiliPlaceholder: 'Search for neighborhood/district',
    kebangsaan: 'Nationality',
    kebangsaanLainnya: 'Other Nationality',
    kebangsaanPlaceholder: 'Enter your nationality',
    selectKebangsaan: 'Select nationality',
    indonesia: 'Indonesia',
    jepang: 'Japan',
    lainnya: 'Other',
    usia: 'Age',
    usiaPlaceholder: 'Current age',
    jenisKelamin: 'Gender',
    lakiLaki: 'Male',
    perempuan: 'Female',
    sectionDataJamaah: 'Congregation Data',
    sectionKehadiran: 'Attendance Information',
    dewasaTambahan: 'Additional Adults',
    dewasaPlaceholder: 'Number of adults besides you',
    hintDewasa: 'Age 13 and above',
    datangDenganAnak: 'Coming with Children?',
    tidak: 'No',
    ya: 'Yes',
    hintAnak: 'Children age 0-12 years',
    jumlahAnak: 'Number of Children',
    hintUsiaAnak: 'Maximum age: 12 years',
    sectionPersetujuan: 'Consent',
    consentText: '<strong>Congregation data</strong> is used solely for registration purposes and the smooth implementation of the iftar gathering. We guarantee the confidentiality of your data.',
    submit: 'Register Now',
    
    // Footer
    prayerMessage: 'May Allah accept our worship in this blessed month of Ramadan',
    footerCopyright: 'Â© 2026 â€” Okayama Central Mosque',
    contactText: 'For more information:',
    totalLabel: 'Total attendees',
    progressText: 'Submitting data...'
  },
  
  ja: {
    // Messages
    fillNameEmail: 'å…ˆã«åå‰ã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
    invalidEmail: 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒç„¡åŠ¹ã§ã™',
    invalidPhone: 'é›»è©±ç•ªå·ãŒç„¡åŠ¹ã§ã™ã€‚æ—¥æœ¬ã®å½¢å¼ï¼ˆ080/090/070ï¼‰ã¾ãŸã¯ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢ã®å½¢å¼ï¼ˆ08ï¼‰ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„',
    processing: 'å‡¦ç†ä¸­...',
    success: 'ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼',
    networkError: 'é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚',
    serverError: 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚',
    selectNationality: 'å›½ç±ã‚’é¸æŠã—ã¦ãã ã•ã„',
    fillOtherNationality: 'å›½ç±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
    consentRequired: 'ãƒ‡ãƒ¼ã‚¿åŒæ„ã«åŒæ„ã—ã¦ãã ã•ã„',
    duplicateData: 'ã™ã§ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™',
    registrationComplete: 'ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’ã”ç¢ºèªãã ã•ã„ã€‚',
    submitting: 'ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ä¸­...',
    
    // UI Text
    duplicateAlert: 'ã™ã§ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™',
    infoMessage: 'é€ä¿¡å¾Œã€ç¢ºèªãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã¾ã™',
    mainTitle: '1447å¹´ ãƒ©ãƒãƒ€ãƒ³ãƒ»ã‚¤ãƒ•ã‚¿ãƒ¼ãƒ«å‚åŠ ç™»éŒ²',
    centerName: 'ã‚ªã‚«ãƒ¤ãƒã‚»ãƒ³ãƒˆãƒ©ãƒ«ãƒ¢ã‚¹ã‚¯',
    subtitle: 'æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ã§ä»¥ä¸‹ã®ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã«ã”è¨˜å…¥ãã ã•ã„',
    eventPurpose: 'ã“ã®ãƒ•ã‚©ãƒ¼ãƒ ã¯é›†å›£ã‚¤ãƒ•ã‚¿ãƒ¼ãƒ«ãŒç§©åºæ­£ã—ãã€å¿«é©ã«ã€ç¥ç¦ã«æº€ã¡ã¦è¡Œã‚ã‚Œã‚‹ã‚ˆã†ã€ç¤¼æ‹è€…ã®ç™»éŒ²ã«ä½¿ç”¨ã•ã‚Œã¾ã™',
    
    // Form labels
    namaLengkap: 'æ°å',
    namaPlaceholder: 'èº«åˆ†è¨¼é€šã‚Šã®æ°å',
    email: 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹',
    emailPlaceholder: 'ä¾‹: example@email.com',
    hintEmail: 'ç¢ºèªãƒ¡ãƒ¼ãƒ«ãŒã“ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«é€ä¿¡ã•ã‚Œã¾ã™',
    noHp: 'é›»è©±ç•ªå·',
    noHpPlaceholder: '08012345678',
    hintNoHp: 'é€£çµ¡å¯èƒ½ãªç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
    domisili: 'å±…ä½åœ°',
    domisiliPlaceholder: 'ç”ºåãƒ»åœ°åŒºåã‚’æ¤œç´¢',
    kebangsaan: 'å›½ç±',
    kebangsaanLainnya: 'ãã®ä»–ã®å›½ç±',
    kebangsaanPlaceholder: 'å›½ç±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
    selectKebangsaan: 'å›½ç±ã‚’é¸æŠ',
    indonesia: 'ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢',
    jepang: 'æ—¥æœ¬',
    lainnya: 'ãã®ä»–',
    usia: 'å¹´é½¢',
    usiaPlaceholder: 'ç¾åœ¨ã®å¹´é½¢',
    jenisKelamin: 'æ€§åˆ¥',
    lakiLaki: 'ç”·æ€§',
    perempuan: 'å¥³æ€§',
    sectionDataJamaah: 'ç¤¼æ‹è€…ãƒ‡ãƒ¼ã‚¿',
    sectionKehadiran: 'å‚åŠ æƒ…å ±',
    dewasaTambahan: 'è¿½åŠ ã®å¤§äºº',
    dewasaPlaceholder: 'ã”æœ¬äººä»¥å¤–ã®å¤§äººã®äººæ•°',
    hintDewasa: '13æ­³ä»¥ä¸Š',
    datangDenganAnak: 'ãŠå­æ§˜ã¨ä¸€ç·’ã§ã™ã‹ï¼Ÿ',
    tidak: 'ã„ã„ãˆ',
    ya: 'ã¯ã„',
    hintAnak: '0ã€œ12æ­³ã®ãŠå­æ§˜',
    jumlahAnak: 'ãŠå­æ§˜ã®äººæ•°',
    hintUsiaAnak: 'æœ€å¤§12æ­³ã¾ã§',
    sectionPersetujuan: 'åŒæ„',
    consentText: '<strong>ç¤¼æ‹è€…ã®ãƒ‡ãƒ¼ã‚¿</strong>ã¯ã€ç™»éŒ²ç›®çš„ã¨é›†å›£ã‚¤ãƒ•ã‚¿ãƒ¼ãƒ«ã®å††æ»‘ãªå®Ÿæ–½ã®ãŸã‚ã«ã®ã¿ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ãŠå®¢æ§˜ã®ãƒ‡ãƒ¼ã‚¿ã®æ©Ÿå¯†æ€§ã‚’ä¿è¨¼ã—ã¾ã™ã€‚',
    submit: 'ä»Šã™ãç™»éŒ²',
    
    // Footer
    prayerMessage: 'ã‚¢ãƒƒãƒ©ãƒ¼ãŒã“ã®å°Šã„ãƒ©ãƒãƒ€ãƒ³æœˆã«ãŠã‘ã‚‹ç§ãŸã¡ã®ç¤¼æ‹ã‚’ãŠå—ã‘å…¥ã‚Œãã ã•ã„ã¾ã™ã‚ˆã†ã«',
    footerCopyright: 'Â© 2026 â€” ã‚ªã‚«ãƒ¤ãƒã‚»ãƒ³ãƒˆãƒ©ãƒ«ãƒ¢ã‚¹ã‚¯',
    contactText: 'è©³ç´°ã«ã¤ã„ã¦ã¯ï¼š',
    totalLabel: 'ç·å‚åŠ è€…æ•°',
    progressText: 'ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ä¸­...'
  }
};

// ============================================
// FUNGSI UTILITAS
// ============================================

function getTranslation(key) {
  return translations[lang][key] || key;
}

function validateEmail(email) {
  const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return re.test(email);
}

function validatePhoneNumber(phone) {
  if (!phone) return false;
  
  let cleanPhone = phone.replace(/\D/g, '');
  
  // Format Indonesia: 62... atau 08...
  if (cleanPhone.startsWith('62')) {
    return cleanPhone.length >= 10 && cleanPhone.length <= 15;
  } else if (cleanPhone.startsWith('08')) {
    return cleanPhone.length >= 10 && cleanPhone.length <= 13;
  } else if (cleanPhone.startsWith('81')) {
    // Format Jepang: 81...
    return cleanPhone.length >= 10 && cleanPhone.length <= 13;
  } else if (cleanPhone.startsWith('0')) {
    // Format Jepang: 080/090/070
    return /^0[789]0\d{8}$/.test(cleanPhone);
  }
  
  return false;
}

function showAlert(type, message) {
  // Sembunyikan semua alert terlebih dahulu
  ['alert', 'success', 'info', 'duplicate'].forEach(t => {
    const el = document.getElementById(`${t}Message`);
    if (el) el.classList.remove('active');
  });
  
  const alertDiv = document.getElementById(`${type}Message`);
  const textSpan = document.getElementById(`${type}MessageText`);
  
  if (alertDiv && textSpan) {
    textSpan.textContent = message;
    alertDiv.classList.add('active');
    
    // Auto hide setelah 5 detik kecuali success
    if (type !== 'success') {
      setTimeout(() => {
        alertDiv.classList.remove('active');
      }, 5000);
    }
  }
}

function calculateTotal() {
  const registrant = 1;
  const additionalAdults = parseInt(document.getElementById('dewasa_tambahan').value) || 0;
  let children = 0;
  
  const denganAnak = document.querySelector('input[name="dengan_anak"]:checked');
  if (denganAnak && denganAnak.value === 'Ya') {
    children = parseInt(document.getElementById('jumlah_anak').value) || 0;
  }
  
  const total = registrant + additionalAdults + children;
  
  document.getElementById('totalAttendees').textContent = total;
  
  let details = '';
  if (lang === 'id') {
    details = `${registrant} pendaftar, ${additionalAdults} dewasa, ${children} anak`;
  } else if (lang === 'en') {
    details = `${registrant} registrant, ${additionalAdults} adults, ${children} children`;
  } else {
    details = `ç™»éŒ²è€…${registrant}åã€å¤§äºº${additionalAdults}åã€å­ä¾›${children}å`;
  }
  
  document.getElementById('totalDetail').textContent = details;
  
  return total;
}

function generateRegistrationId() {
  const prefix = 'IFTAR';
  const date = new Date();
  const dateStr = date.getFullYear().toString().slice(-2) + 
                  (date.getMonth() + 1).toString().padStart(2, '0') + 
                  date.getDate().toString().padStart(2, '0');
  const random = Math.random().toString(36).substr(2, 6).toUpperCase();
  return `${prefix}-${dateStr}-${random}`;
}

function showDuplicateAlert() {
  document.getElementById('duplicateAlert').classList.add('active');
  document.getElementById('submitBtn').disabled = true;
}

// ============================================
// FUNGSI API DENGAN ERROR HANDLING
// ============================================

async function makeAPICall(action, params = {}, method = 'POST') {
  try {
    const formData = new URLSearchParams();
    for (const key in params) {
      formData.append(key, params[key]);
    }
    
    const response = await fetch(
      `${CONFIG.API_URL}?action=${encodeURIComponent(action)}`,
      {
        method: method,
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: formData.toString(),
        mode: 'cors'
      }
    );

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    return await response.json();
  } catch (error) {
    console.error(`API call failed (${action}):`, error);
    return {
      success: false,
      error: getTranslation('networkError')
    };
  }
}

async function checkDuplicate() {
  const email = document.getElementById('email').value.trim().toLowerCase();
  const phone = document.getElementById('no_hp').value.trim();
  
  if (!email || !phone) return;
  
  try {
    const params = new URLSearchParams();
    params.append('email', email);
    params.append('no_hp', phone);
    
    const response = await fetch(
      `${CONFIG.API_URL}?action=check_duplicate&${params.toString()}`,
      { method: 'GET', mode: 'cors' }
    );
    
    const result = await response.json();
    
    if (result.isDuplicate) {
      showDuplicateAlert();
    } else {
      document.getElementById('duplicateAlert').classList.remove('active');
      document.getElementById('submitBtn').disabled = false;
    }
  } catch (error) {
    console.error('Duplicate check error:', error);
  }
}

async function submitRegistration(formData) {
  try {
    const registrationId = generateRegistrationId();
    
    const dataToSubmit = {
      timestamp: new Date().toISOString(),
      registration_id: registrationId,
      nama_lengkap: formData.nama_lengkap,
      email: formData.email,
      no_hp: formData.no_hp,
      domisili: formData.domisili,
      kebangsaan: formData.kebangsaan || formData.kebangsaan_lainnya || '',
      usia: formData.usia,
      jk: formData.jk,
      dewasa_tambahan: formData.dewasa_tambahan || 0,
      dengan_anak: formData.dengan_anak || 'Tidak',
      jumlah_anak: formData.jumlah_anak || 0,
      total: calculateTotal(),
      status: 'Menunggu',
      checkin_time: '',
      lang_used: lang
    };

    const result = await makeAPICall('register', dataToSubmit, 'POST');
    
    // âœ… TAMBAHKAN HANDLER DUPLICATE RESPONSE
    if (result.status === "duplicate") {
      showDuplicateAlert();
      return {
        success: false,
        status: "duplicate"
      };
    }

    if (result.status === "success") {
      // âœ… PERBAIKI REDIRECT KE success.html (HANYA ID SAJA)
      setTimeout(() => {
        window.location.href = `success.html?id=${result.id}`;
      }, 800);
      
      return { success: true, id: result.id };
    } else {
      return { 
        success: false, 
        error: result.error || getTranslation('serverError')
      };
    }
  } catch (error) {
    console.error('Submission error:', error);
    return { 
      success: false, 
      error: getTranslation('networkError')
    };
  }
}

// ============================================
// MULTILINGUAL SUPPORT
// ============================================

function initMultilingual() {
  const t = translations[lang];
  
  // Update alert messages
  document.getElementById('duplicateAlertText').textContent = t.duplicateAlert;
  document.getElementById('infoMessageText').textContent = t.infoMessage;
  document.getElementById('progressText').textContent = t.progressText;
  
  // Update header
  document.getElementById('mainTitle').textContent = t.mainTitle;
  document.getElementById('centerName').textContent = t.centerName;
  document.getElementById('subtitleText').textContent = t.subtitle;
  document.getElementById('eventPurpose').textContent = t.eventPurpose;
  
  // Update form labels
  document.getElementById('labelNamaLengkap').textContent = t.namaLengkap;
  document.getElementById('nama_lengkap').placeholder = t.namaPlaceholder;
  
  document.getElementById('labelEmail').textContent = t.email;
  document.getElementById('email').placeholder = t.emailPlaceholder;
  document.getElementById('hintEmail').textContent = t.hintEmail;
  
  document.getElementById('labelNoHp').textContent = t.noHp;
  document.getElementById('no_hp').placeholder = t.noHpPlaceholder;
  document.getElementById('hintNoHp').textContent = t.hintNoHp;
  
  document.getElementById('labelDomisili').textContent = t.domisili;
  document.getElementById('domisili').placeholder = t.domisiliPlaceholder;
  
  document.getElementById('labelKebangsaan').textContent = t.kebangsaan;
  document.querySelector('#kebangsaan option[value=""]').textContent = t.selectKebangsaan;
  document.querySelector('#kebangsaan option[value="Indonesia"]').textContent = t.indonesia;
  document.querySelector('#kebangsaan option[value="Jepang"]').textContent = t.jepang;
  document.querySelector('#kebangsaan option[value="Lainnya"]').textContent = t.lainnya;
  
  document.getElementById('labelUsia').textContent = t.usia;
  document.getElementById('usia').placeholder = t.usiaPlaceholder;
  
  document.getElementById('labelJenisKelamin').textContent = t.jenisKelamin;
  document.getElementById('labelLakiLaki').textContent = t.lakiLaki;
  document.getElementById('labelPerempuan').textContent = t.perempuan;
  
  document.getElementById('sectionDataJamaah').textContent = t.sectionDataJamaah;
  document.getElementById('sectionKehadiran').textContent = t.sectionKehadiran;
  
  document.getElementById('labelDewasaTambahan').textContent = t.dewasaTambahan;
  document.getElementById('dewasa_tambahan').placeholder = t.dewasaPlaceholder;
  document.getElementById('hintDewasa').textContent = t.hintDewasa;
  
  document.getElementById('labelDatangDenganAnak').textContent = t.datangDenganAnak;
  document.getElementById('labelTidak').textContent = t.tidak;
  document.getElementById('labelYa').textContent = t.ya;
  document.getElementById('hintAnak').textContent = t.hintAnak;
  
  document.getElementById('labelJumlahAnak').textContent = t.jumlahAnak;
  document.getElementById('hintUsiaAnak').textContent = t.hintUsiaAnak;
  
  document.getElementById('sectionPersetujuan').textContent = t.sectionPersetujuan;
  document.getElementById('consentText').innerHTML = t.consentText;
  
  document.getElementById('submitText').textContent = t.submit;
  
  document.getElementById('prayerMessage').textContent = t.prayerMessage;
  document.getElementById('footerCopyright').textContent = t.footerCopyright;
  document.getElementById('contactText').textContent = t.contactText;
  
  document.getElementById('totalLabel').textContent = t.totalLabel;
  
  // Update total detail
  calculateTotal();
}

// ============================================
// FORM HANDLING
// ============================================

async function handleFormSubmit(e) {
  e.preventDefault();
  
  if (isSubmitting) {
    console.log('Form sedang diproses, tunggu...');
    return;
  }
  
  // Validasi kebangsaan
  const selectedNationality = document.getElementById('kebangsaan').value;
  if (!selectedNationality) {
    showAlert('alert', getTranslation('selectNationality'));
    document.getElementById('kebangsaan').focus();
    return;
  }
  
  if (selectedNationality === 'Lainnya') {
    const otherNationality = document.getElementById('kebangsaan_lainnya').value.trim();
    if (!otherNationality) {
      showAlert('alert', getTranslation('fillOtherNationality'));
      document.getElementById('kebangsaan_lainnya').focus();
      return;
    }
  }
  
  // Validasi nomor telepon
  const phone = document.getElementById('no_hp').value;
  if (!validatePhoneNumber(phone)) {
    showAlert('alert', getTranslation('invalidPhone'));
    document.getElementById('no_hp').focus();
    return;
  }
  
  // Validasi email
  const email = document.getElementById('email').value;
  if (!validateEmail(email)) {
    showAlert('alert', getTranslation('invalidEmail'));
    document.getElementById('email').focus();
    return;
  }
  
  // Cek persetujuan
  if (!document.getElementById('consentCheckbox').checked) {
    showAlert('alert', getTranslation('consentRequired'));
    document.getElementById('consentCheckbox').focus();
    return;
  }
  
  // Prepare form data
  const form = document.getElementById('registrationForm');
  const formData = new FormData(form);
  const data = {};
  
  for (const [key, value] of formData.entries()) {
    data[key] = value.toString().trim();
  }
  
  if (data.kebangsaan === 'Lainnya') {
    data.kebangsaan = document.getElementById('kebangsaan_lainnya').value.trim();
  }
  
  data.total_kehadiran = calculateTotal();
  data.total = data.total_kehadiran;
  
  // Set submitting state
  isSubmitting = true;
  const submitBtn = document.getElementById('submitBtn');
  const progressIndicator = document.getElementById('progressIndicator');
  const originalText = submitBtn.innerHTML;
  
  submitBtn.disabled = true;
  progressIndicator.classList.add('active');
  submitBtn.innerHTML = `<span class="loading-spinner" style="display: inline-block; width: 16px; height: 16px; margin-right: 8px;"></span> ${getTranslation('processing')}`;
  
  try {
    const result = await submitRegistration(data);
    
    if (result.success) {
      showAlert('success', getTranslation('registrationComplete'));
      submitBtn.innerHTML = `<i class="fas fa-check-circle" style="margin-right: 8px;"></i> ${getTranslation('success')}`;
      submitBtn.style.background = 'linear-gradient(135deg, #059669, #10b981)';
    } else {
      if (result.status === "duplicate") {
        showDuplicateAlert();
      } else {
        showAlert('alert', result.error || getTranslation('networkError'));
      }
      isSubmitting = false;
      submitBtn.disabled = false;
      progressIndicator.classList.remove('active');
      submitBtn.innerHTML = originalText;
    }
  } catch (error) {
    showAlert('alert', getTranslation('networkError'));
    isSubmitting = false;
    submitBtn.disabled = false;
    progressIndicator.classList.remove('active');
    submitBtn.innerHTML = originalText;
  }
}

// ============================================
// EVENT LISTENERS SETUP
// ============================================

function setupEventListeners() {
  // Language selector
  document.getElementById('languageSelector').addEventListener('change', function(e) {
    lang = e.target.value;
    initMultilingual();
  });
  
  // Nationality selection
  document.getElementById('kebangsaan').addEventListener('change', function(e) {
    const otherWrapper = document.getElementById('otherNationalityWrapper');
    otherWrapper.classList.toggle('active', e.target.value === 'Lainnya');
  });
  
  // Children toggle
  document.querySelectorAll('input[name="dengan_anak"]').forEach(radio => {
    radio.addEventListener('change', function() {
      const childrenWrapper = document.getElementById('childrenFieldWrapper');
      childrenWrapper.classList.toggle('active', this.value === 'Ya');
      calculateTotal();
    });
  });
  
  // Real-time calculations
  document.getElementById('dewasa_tambahan').addEventListener('input', calculateTotal);
  document.getElementById('jumlah_anak').addEventListener('input', calculateTotal);
  
  // Duplicate check dengan debounce
  function scheduleDuplicateCheck() {
    clearTimeout(duplicateCheckTimeout);
    duplicateCheckTimeout = setTimeout(checkDuplicate, 800);
  }
  
  document.getElementById('email').addEventListener('input', scheduleDuplicateCheck);
  document.getElementById('no_hp').addEventListener('input', scheduleDuplicateCheck);
  
  // Reset alert ketika field berubah
  document.getElementById('email').addEventListener('input', function() {
    document.getElementById('alertMessage').classList.remove('active');
    document.getElementById('duplicateAlert').classList.remove('active');
    document.getElementById('submitBtn').disabled = false;
  });
  
  document.getElementById('no_hp').addEventListener('input', function() {
    document.getElementById('alertMessage').classList.remove('active');
    document.getElementById('duplicateAlert').classList.remove('active');
    document.getElementById('submitBtn').disabled = false;
  });
  
  // Form submission
  document.getElementById('registrationForm').addEventListener('submit', handleFormSubmit);
  
  // Enable submit button ketika consent di-check
  document.getElementById('consentCheckbox').addEventListener('change', function() {
    const submitBtn = document.getElementById('submitBtn');
    const isDuplicate = document.getElementById('duplicateAlert').classList.contains('active');
    submitBtn.disabled = !this.checked || isDuplicate;
  });
}

// ============================================
// INITIALIZATION
// ============================================

document.addEventListener('DOMContentLoaded', function() {
  // Initialize multilingual
  initMultilingual();
  
  // Set initial language selector
  document.getElementById('languageSelector').value = lang;
  
  // Show info message
  document.getElementById('infoMessage').classList.add('active');
  
  // Setup event listeners
  setupEventListeners();
  
  // Calculate initial total
  calculateTotal();
  
  // Enable form validation
  document.getElementById('registrationForm').addEventListener('input', function() {
    const form = this;
    const submitBtn = document.getElementById('submitBtn');
    const isFormValid = form.checkValidity();
    const isDuplicate = document.getElementById('duplicateAlert').classList.contains('active');
    const isConsent = document.getElementById('consentCheckbox').checked;
    
    submitBtn.disabled = !isFormValid || isDuplicate || !isConsent;
  });
});
</script>
</body>
</html>
